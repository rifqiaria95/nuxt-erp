import{e as l,f as n}from"./Bkm6qw8b.js";import{S as o}from"./9Qm2jZ7z.js";const h=l("jabatan",{state:()=>({jabatans:[],loading:!1,error:null,stats:{total:void 0,direktur_utama:void 0,direktur_keuangan:void 0,direktur_operasional:void 0,general_manager:void 0},totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{nmJabatan:""},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchJabatans(){this.loading=!0;const{$api:a}=n();try{const t=localStorage.getItem("token"),i=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),r=await(await fetch(`${a.jabatan()}?${i.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,Accept:"application/json"},credentials:"include"})).json();this.jabatans=(r.data||[]).map(e=>({id:e.idJabatan,nmJabatan:e.nmJabatan,createdAt:e.createdAt,updatedAt:e.updatedAt})),this.totalRecords=r.meta.total}catch(t){console.error("Gagal mengambil data jabatan:",t),o.fire("Error","Gagal mengambil data jabatan","error")}finally{this.loading=!1}},async fetchStats(){const{$api:a}=n(),t={total:void 0,direktur_utama:void 0,direktur_keuangan:void 0,direktur_operasional:void 0,general_manager:void 0};try{const i=localStorage.getItem("token"),s=await fetch(a.countPegawaiByJabatan(),{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},credentials:"include"});if(s.ok){const r=await s.json();this.stats=r}else this.stats=t}catch(i){console.error("Gagal mengambil data statistik (exception):",i),this.stats=t}},async saveJabatan(){this.loading=!0,this.validationErrors=[];const{$api:a}=n();try{const t=localStorage.getItem("token");let i=a.jabatan(),s="POST";this.isEditMode&&this.form.id&&(i=`${a.jabatan()}/${this.form.id}`,s="PUT");const r=await fetch(i,{method:s,headers:{Authorization:`Bearer ${t}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({nm_jabatan:this.form.nmJabatan}),credentials:"include"});if(!r.ok){const e=await r.json();throw e.errors&&(this.validationErrors=Object.values(e.errors).flat()),new Error(e.message||"Gagal menyimpan data jabatan")}this.closeModal(),await this.fetchJabatans(),await this.fetchStats(),o.fire("Berhasil!",`Jabatan berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(t){o.fire("Error",t.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteJabatan(a){this.loading=!0;const{$api:t}=n();if(!(await o.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const s=localStorage.getItem("token"),r=await fetch(`${t.jabatan()}/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,Accept:"application/json"},credentials:"include"});if(!r.ok){const e=await r.json();throw new Error(e.message||"Gagal menghapus jabatan")}await this.fetchJabatans(),await this.fetchStats(),o.fire("Berhasil!","Jabatan berhasil dihapus.","success")}catch(s){o.fire("Error",s.message||"Gagal menghapus jabatan","error")}finally{this.loading=!1}},openModal(a=null){this.isEditMode=!!a,this.validationErrors=[],a?this.form={id:a.id,nmJabatan:a.nmJabatan}:this.form={nmJabatan:""},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={nmJabatan:""},this.validationErrors=[]},setPagination(a){this.params.first=a.first,this.params.rows=a.rows,this.fetchJabatans()},setSort(a){this.params.sortField=a.sortField,this.params.sortOrder=a.sortOrder,this.fetchJabatans()},setSearch(a){this.params.search=a,this.params.first=0,this.fetchJabatans()}}});export{h as u};
