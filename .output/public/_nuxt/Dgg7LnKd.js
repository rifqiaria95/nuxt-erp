import{e as te,f as P,j as R,s as oe,k as E,g as ae,l as F,c as x,a as s,b as p,i as o,w as k,o as _,q as ie,v as U,E as S,z as re,A as T,B as ne,G as z,H as le,F as de,x as ce,n as G,t as me,d as ue}from"./Bkm6qw8b.js";import{_ as pe}from"./mvyRji1Y.js";import{S as b}from"./9Qm2jZ7z.js";import{_ as fe}from"./BAMzpvu1.js";import{_ as he}from"./DleeVanq.js";import{u as ge}from"./CI-DMe-d.js";const ve=te("roles",{state:()=>({roles:[],permissions:[],loading:!0,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{name:"",permissionIds:[]},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchRoles(){this.loading=!0,this.error=null;const{$api:r}=P();try{const d=new URLSearchParams({draw:"1",start:this.params.first.toString(),length:this.params.rows.toString(),"search[value]":this.params.search||""}),a=localStorage.getItem("token"),n=await fetch(`${r.roles()}?${d.toString()}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"},credentials:"include"});if(!n.ok)throw new Error("Gagal mengambil data roles");const l=await n.json();this.roles=l.data||[],this.totalRecords=Number(l.recordsFiltered)||0}catch(d){this.error=d.message,b.fire("Error",`Tidak dapat memuat data roles: ${d.message}`,"error")}finally{this.loading=!1}},async fetchPermissions(){const{$api:r}=P(),d=localStorage.getItem("token");try{const a=await fetch(r.getPermissions(),{headers:{Authorization:`Bearer ${d}`,Accept:"application/json"},credentials:"include"});if(!a.ok)throw new Error(`HTTP Error fetching all permissions: ${a.status}`);const n=await a.json();this.permissions=n.data||n||[]}catch(a){this.permissions=[],b.fire("Error",`Gagal memuat permissions: ${a.message}`,"error")}},async saveRole(){this.loading=!0,this.validationErrors=[];const{$api:r}=P();try{const d=localStorage.getItem("token");let a=r.roleStore(),n="POST";this.isEditMode&&this.form.id&&(a=r.roleUpdate(this.form.id),n="PUT");const l={name:this.form.name,permissionIds:this.form.permissionIds.filter(h=>typeof h=="number"&&h>0)},f=await fetch(a,{method:n,headers:{Authorization:`Bearer ${d}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l),credentials:"include"});if(!f.ok){const h=await f.json();throw f.status===422||h.errors?(this.validationErrors=Array.isArray(h.errors)?h.errors:Object.values(h.errors).flat(),new Error("Data validasi tidak valid")):new Error(h.message||"Gagal menyimpan data role")}this.closeModal(),await this.fetchRoles(),b.fire("Berhasil!",`Role berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(d){d.message!=="Data validasi tidak valid"&&b.fire("Error",d.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteRole(r){const{$api:d}=P();if((await b.fire({title:"Apakah Anda yakin?",text:"Role yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!0;try{const n=localStorage.getItem("token"),l=await fetch(d.roleDelete(r),{method:"DELETE",headers:{Authorization:`Bearer ${n}`,Accept:"application/json"},credentials:"include"});if(!l.ok){const f=await l.json();throw new Error(f.message||"Gagal menghapus role")}await this.fetchRoles(),b.fire("Berhasil!","Role berhasil dihapus.","success")}catch(n){b.fire("Error",n.message||"Gagal menghapus role","error")}finally{this.loading=!1}}},async openModal(r=null){if(this.isEditMode=!!r,this.validationErrors=[],r){const{$api:d}=P(),a=localStorage.getItem("token");try{const n=await fetch(d.roleShow(r.id),{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"},credentials:"include"});if(!n.ok)throw new Error("Gagal memuat detail role.");const l=await n.json();this.form={id:l.id,name:l.name||"",permissionIds:Array.isArray(l.permissions)?l.permissions:[]}}catch(n){b.fire("Error",n.message,"error");return}}else this.form={id:void 0,name:"",permissionIds:[]};this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={id:void 0,name:"",permissionIds:[]},this.validationErrors=[]},setPagination(r){this.params.first=r.first,this.params.rows=r.rows,this.fetchRoles()},setSort(r){this.params.sortField=r.sortField,this.params.sortOrder=r.sortOrder,this.fetchRoles()},setSearch(r){this.params.search=r,this.params.first=0,this.fetchRoles()}}}),be={class:"content-wrapper"},we={class:"container-xxl flex-grow-1 container-p-y"},ye={key:0,class:"text-center"},ke={key:1},Re={class:"row g-6 mb-6"},xe={class:"col-xl-4 col-lg-6 col-md-6"},_e={class:"card h-100"},Pe={class:"row h-100"},Ee={class:"col-sm-7"},Se={class:"card-body text-sm-end text-center ps-sm-0"},Ae={class:"row g-6"},Me={class:"col-12"},Ce={class:"card"},$e={class:"card-header d-flex justify-content-between align-items-center flex-wrap"},je={class:"d-flex align-items-center me-3 mb-2 mb-md-0"},Te={class:"d-flex align-items-center"},Le={class:"p-input-icon-left"},Be={class:"card-datatable table-responsive py-3 px-3"},Ve={class:"d-flex align-items-center"},De=["onClick"],Ie=["onClick"],Ne={class:"row g-3 p-3"},Oe={class:"col-12 mb-3"},Fe={class:"form-floating form-floating-outline"},Ue={class:"col-12"},ze={class:"d-flex justify-content-between align-items-center flex-wrap gap-4 mb-4"},Ge={class:"d-flex align-items-center gap-4"},qe={class:"form-check"},He={class:"d-flex align-items-center"},Je={class:"p-input-icon-left"},We={class:"text-center w-100 font-weight-bold"},Ke={key:0,class:"form-check d-flex justify-content-center"},Ye=["value"],Qe={class:"modal-footer mt-6"},Xe=["disabled"],Ze={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},rs={__name:"roles",setup(r){const d=R(null),a=ve(),{roles:n,permissions:l,loading:f,totalRecords:h,params:A,form:w,isEditMode:L,showModal:q,validationErrors:H}=oe(a),M=R(""),J=R([10,25,50,100]),C=R(""),$=["View","Create","Edit","Delete","Show","Approve","Reject"],W=R(10);R([5,10,25,50]);const B=E({get(){return!l.value||l.value.length===0?!1:w.value.permissionIds.length===l.value.length},set(i){i?w.value.permissionIds=l.value.map(e=>e.id):w.value.permissionIds=[]}}),V=(i,e)=>i.permissions.find(t=>t.name===e),D=E(()=>{const i={};(Array.isArray(l.value)?l.value:[]).forEach(c=>{var N,O;const v=(N=c.name)==null?void 0:N.split("_");let m="";v&&v.length>1?m=v.slice(1).join("_"):m="general",m.endsWith("s")&&(m=m.slice(0,-1));let u="";const g=(O=c.name)==null?void 0:O.toLowerCase();if(g.includes("view")?u="View":g.includes("create")?u="Create":g.includes("update")||g.includes("edit")?u="Edit":g.includes("delete")?u="Delete":g.includes("show")?u="Show":g.includes("approve")?u="Approve":g.includes("reject")&&(u="Reject"),!u)return;const I={id:c.id,name:u,dbName:c.name};i[m]||(i[m]={id:m,name:m.replace(/_/g," ").replace(/\b\w/g,j=>j.toUpperCase()),order:Object.keys(i).length,permissions:[]}),i[m].permissions.some(j=>j.id===I.id)||i[m].permissions.push(I)});const t=Object.values(i).sort((c,v)=>c.name.localeCompare(v.name));return t.forEach(c=>{c.permissions.sort((v,m)=>{const u=$.indexOf(v.name),g=$.indexOf(m.name);return u-g})}),t}),K=E(()=>{if(!C.value)return D.value;const i=C.value.toLowerCase();return D.value.filter(e=>e.name.toLowerCase().includes(i))}),Y=E(()=>L.value?"Edit Role":"Tambah Role"),Q=E(()=>L.value?"Ubah detail role.":"Isi untuk menambah role baru.");let y=null;ae(()=>{a.fetchRoles(),a.fetchPermissions();const i=document.getElementById("RolesModal");i&&(y=new bootstrap.Modal(i))}),F(q,i=>{i?y==null||y.show():y==null||y.hide()});const X=ge(()=>{a.setSearch(M.value)},500);F(M,X);const Z=i=>a.setPagination(i),ee=()=>{A.value.first=0,a.fetchRoles()},se=i=>a.setSort(i);return(i,e)=>(_(),x("div",null,[s("div",be,[s("div",we,[o(f)?(_(),x("div",ye,e[11]||(e[11]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):(_(),x("div",ke,[e[18]||(e[18]=s("h4",{class:"mb-1"},"Roles List",-1)),e[19]||(e[19]=s("p",{class:"mb-6"}," A role provided access to predefined menus and features so that depending on assigned role an administrator can have access to what user needs. ",-1)),s("div",Re,[s("div",xe,[s("div",_e,[s("div",Pe,[e[13]||(e[13]=s("div",{class:"col-sm-5"},[s("div",{class:"d-flex align-items-end h-100 justify-content-center"},[s("img",{src:pe,class:"img-fluid",alt:"Image",width:"70"})])],-1)),s("div",Ee,[s("div",Se,[s("button",{onClick:e[0]||(e[0]=t=>o(a).openModal()),class:"btn btn-primary mb-2 text-nowrap add-new-role"}," Tambah Role "),e[12]||(e[12]=s("p",{class:"mb-0 mt-1"},"Buat role baru beserta hak aksesnya",-1))])])])])])]),s("div",Ae,[e[17]||(e[17]=s("div",{class:"col-12"},[s("h4",{class:"mt-6 mb-1"},"Total users with their roles"),s("p",{class:"mb-0"},"Find all of your company's administrator accounts and their associate roles.")],-1)),s("div",Me,[s("div",Ce,[s("div",$e,[s("div",je,[e[14]||(e[14]=s("span",{class:"me-2"},"Baris:",-1)),p(o(ie),{modelValue:o(A).rows,"onUpdate:modelValue":e[1]||(e[1]=t=>o(A).rows=t),options:J.value,onChange:ee,placeholder:"Jumlah",style:{width:"8rem"}},null,8,["modelValue","options"])]),s("div",Te,[s("span",Le,[p(o(U),{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=t=>M.value=t),placeholder:"Cari Role...",class:"w-full md:w-20rem"},null,8,["modelValue"])])])]),s("div",Be,[p(he,{ref_key:"myDataTableRef",ref:d,data:o(n),rows:o(A).rows,loading:o(f),totalRecords:o(h),lazy:!0,onPage:e[3]||(e[3]=t=>Z(t)),onSort:e[4]||(e[4]=t=>se(t)),paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} data"},{default:k(()=>[p(o(S),{field:"id",header:"#",sortable:!0}),p(o(S),{field:"name",header:"Nama Role",sortable:!0}),p(o(S),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:k(t=>[s("div",Ve,[s("button",{onClick:c=>o(a).openModal(t.data),class:"btn btn-sm btn-icon btn-text-secondary rounded-pill btn-icon me-2"},e[15]||(e[15]=[s("i",{class:"ri-edit-box-line ri-20px"},null,-1)]),8,De),s("button",{onClick:c=>o(a).deleteRole(t.data.id),class:"btn btn-sm btn-icon btn-text-secondary rounded-pill btn-icon"},e[16]||(e[16]=[s("i",{class:"ri-delete-bin-7-line ri-20px"},null,-1)]),8,Ie)])]),_:1})]),_:1},8,["data","rows","loading","totalRecords"])])])])])])),p(fe,{id:"RolesModal",title:Y.value,description:Q.value,"validation-errors-from-parent":o(H)},{default:k(()=>[s("form",{onSubmit:e[10]||(e[10]=re(t=>o(a).saveRole(),["prevent"]))},[s("div",Ne,[s("div",Oe,[s("div",Fe,[T(s("input",{type:"text",id:"modalRoleName",name:"modalRoleName",class:"form-control",placeholder:"Enter a role name",tabindex:"-1","onUpdate:modelValue":e[5]||(e[5]=t=>o(w).name=t),required:""},null,512),[[ne,o(w).name]]),e[20]||(e[20]=s("label",{for:"modalRoleName"},"Role Name",-1))])]),s("div",Ue,[e[23]||(e[23]=s("div",{class:"d-flex justify-content-between align-items-center mb-3"},[s("div",null,[s("h5",{class:"mb-0"},"Role Permissions")])],-1)),s("div",ze,[s("div",Ge,[s("div",qe,[T(s("input",{class:"form-check-input",type:"checkbox",id:"selectAll","onUpdate:modelValue":e[6]||(e[6]=t=>B.value=t)},null,512),[[z,B.value]]),e[21]||(e[21]=s("label",{class:"form-check-label",for:"selectAll"},"Pilih Semua",-1))])]),s("div",He,[s("span",Je,[p(o(U),{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=t=>C.value=t),placeholder:"Cari Menu..."},null,8,["modelValue"])])])]),p(o(le),{value:K.value,rows:W.value,paginator:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} menu",responsiveLayout:"scroll",class:"p-datatable-sm"},{empty:k(()=>e[22]||(e[22]=[s("div",{class:"text-center p-4"},"Tidak ada data menu.",-1)])),default:k(()=>[p(o(S),{field:"name",header:"Menu",sortable:!0,style:{"min-width":"12rem"}}),(_(),x(de,null,ce($,t=>p(o(S),{key:t,style:{"min-width":"6rem"}},{header:k(()=>[s("div",We,me(t),1)]),body:k(({data:c})=>[V(c,t)?(_(),x("div",Ke,[T(s("input",{class:"form-check-input",type:"checkbox",value:V(c,t).id,"onUpdate:modelValue":e[8]||(e[8]=v=>o(w).permissionIds=v)},null,8,Ye),[[z,o(w).permissionIds]])])):G("",!0)]),_:2},1024)),64))]),_:1},8,["value","rows"])])]),s("div",Qe,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[9]||(e[9]=t=>o(a).closeModal())},"Tutup"),s("button",{type:"submit",class:"btn btn-primary",disabled:o(f)},[o(f)?(_(),x("span",Ze)):G("",!0),e[24]||(e[24]=ue(" Simpan "))],8,Xe)])],32)]),_:1},8,["title","description","validation-errors-from-parent"])]),e[25]||(e[25]=s("div",{class:"content-backdrop fade"},null,-1))])]))}};export{rs as default};
