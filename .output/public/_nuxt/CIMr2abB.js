import{_ as ce,f as ue,j as T,s as V,k as j,l as P,K as me,g as fe,c as k,a,b as i,m as I,n as g,i as o,d as c,w as u,D as pe,r as ve,o as m,q as ge,v as be,t as f,y as he,z as A,A as D,B as E,F as ke,x as _e}from"./Bkm6qw8b.js";import{u as Te}from"./u26IMBn3.js";import{u as ye}from"./CUQ1j-C_.js";import{u as we}from"./WyHMcmGb.js";import{u as Se}from"./DD8T_SWG.js";import{u as xe}from"./Bmp6y9tu.js";import{_ as Ce}from"./BAMzpvu1.js";import{_ as w}from"./CdgIhitS.js";import{_ as Ve}from"./DleeVanq.js";import{S as p}from"./9Qm2jZ7z.js";import{C as S}from"./D9zIpW-x.js";import{u as Pe}from"./VXGyPOT6.js";import{u as Ie}from"./Ca1Fz0tn.js";import"./D1pefl20.js";const Be={class:"content-wrapper"},Me={class:"container-xxl flex-grow-1 container-p-y"},je={class:"row g-6 mb-6"},Ae={class:"row g-6"},De={class:"col-12"},Ee={class:"card"},$e={class:"card-header d-flex justify-content-between align-items-center flex-wrap"},Ue={class:"d-flex align-items-center me-3 mb-2 mb-md-0"},Le={class:"d-flex align-items-center"},Fe={class:"btn-group me-2"},Re={class:"dropdown-menu"},Ne={class:"input-group"},We={class:"p-input-icon-left"},qe={class:"card-datatable table-responsive py-3 px-3"},Ge={class:"badge bg-primary"},ze={class:"d-inline-block"},He={class:"dropdown-menu"},Je={key:0},Oe=["onClick"],Ke={key:1},Ye=["onClick"],Qe={key:2},Xe=["onClick"],Ze={key:3},ea=["onClick"],aa={class:"row g-6"},ta={class:"col-md-12"},oa={class:"form-floating form-floating-outline"},sa={class:"col-md-6"},ra={class:"form-floating form-floating-outline"},na={class:"col-md-6"},la={class:"form-floating form-floating-outline"},ia={class:"col-md-6"},da={class:"form-floating form-floating-outline"},ca={class:"col-md-6"},ua={class:"form-floating form-floating-outline"},ma={class:"col-md-6"},fa={class:"form-floating form-floating-outline"},pa={class:"col-md-6"},va={class:"form-floating form-floating-outline"},ga={class:"row"},ba={class:"mb-4 col-lg-4 col-xl-4 col-12 mb-0"},ha={class:"form-floating form-floating-outline stock-transfer-item-select"},ka={class:"mb-4 col-lg-2 col-xl-2 col-2 mb-0"},_a={class:"form-floating form-floating-outline"},Ta=["value"],ya={class:"mb-3 col-lg-4 col-xl-3 col-12 mb-0"},wa={class:"form-floating form-floating-outline"},Sa=["value","onInput"],xa={class:"col-lg-2 col-xl-3 col-12 mt-1"},Ca=["onClick"],Va={class:"mt-0"},Pa={class:"d-flex justify-content-end"},Ia={type:"submit",class:"btn btn-primary me-2"},Ba={__name:"stock-transfer",setup(Ma){const{$api:ja}=ue(),B=T(null),G=Te(),r=ye(),$=we(),z=Pe(),U=Se(),L=xe(),{userHasPermission:x,userHasRole:H}=Ie(),{stockTransfers:J,totalRecords:O,stats:v,params:b,form:n,isEditMode:_,showModal:K,validationErrors:Y,productsInWarehouse:Q}=V(r),{warehouseList:F}=V($),{perusahaans:X}=V(U),{cabangs:R}=V(L),Z=T(null),ee=T(!1),M=T(""),ae=pe();T([{label:"Draft",value:"draft"},{label:"Approved",value:"approved"}]);const te=T([10,25,50,100]),oe=j(()=>_.value?"Edit Stock Transfer":"Tambah Stock Transfer"),se=j(()=>_.value?"Silakan ubah data Stock Transfer di bawah ini.":"Silakan isi form di bawah ini untuk menambahkan Stock Transfer baru.");P(K,s=>{const e=document.getElementById("Modal");if(e&&window.bootstrap){const l=bootstrap.Modal.getInstance(e)||new bootstrap.Modal(e);s?l.show():l.hide()}});let y=null;P(M,s=>{y&&clearTimeout(y),y=setTimeout(()=>{r.setSearch(s)},500)}),me(()=>{y&&clearTimeout(y)}),P(()=>n.value.perusahaanId,s=>{s&&(_.value||(n.value.cabangId=null))});const re=j(()=>!n.value.perusahaanId||!R.value?[]:R.value.filter(s=>s.perusahaanId===n.value.perusahaanId));P(()=>n.value.fromWarehouseId,(s,e)=>{s?(r.fetchProductsByWarehouse(s),e&&s!==e&&(n.value.stockTransferItems=[],r.addItem())):(r.productsInWarehouse=[],n.value.stockTransferItems&&(n.value.stockTransferItems=[],r.addItem()))},{immediate:!1});const ne=async()=>{if(!n.value.date)return p.fire("Validasi","Tanggal wajib diisi.","warning");try{await r.saveStockTransfer(),await r.fetchStockTransfersPaginated(),r.closeModal(),p.fire("Berhasil!",`Stock Transfer berhasil ${_.value?"diperbarui":"dibuat"}.`,"success")}catch(s){const e=s;e.errors?(r.validationErrors=Array.isArray(e.errors)?e.errors:Object.values(e.errors).flat(),p.fire("Gagal","Terdapat kesalahan validasi data.","error")):e.status===422?r.validationErrors=e.errors:e.errors}},le=async s=>{try{await r.approveStockTransfer(s),await r.fetchStockTransfersPaginated()}catch(e){let l="Gagal menyetujui Stock Transfer";e instanceof Error?l=e.message:typeof e=="string"&&(l=e);try{const t=JSON.parse(l);if(t.errors)return r.validationErrors=Array.isArray(t.errors)?t.errors:Object.values(t.errors).flat(),p.fire("Gagal","Terdapat kesalahan validasi data.","error");l=t.message||l}catch{}await p.fire("Error",l,"error")}},N=async()=>{try{await r.fetchStockTransfersPaginated()}catch(s){const e=s.message;p.fire("Error",`Tidak dapat memuat data Stock Transfer: ${e}`,"error")}};fe(()=>{z.fetchPermissions(),G.loadUser(),N(),r.fetchStats(),$.fetchAllWarehouses(),U.fetchPerusahaans(),L.fetchCabangs()});const W=s=>{s==="csv"?B.value.exportCSV():s==="pdf"&&B.value.exportPDF()},ie=s=>{ae.push({path:"/inventory/stock-transfer-detail",query:{id:s}})},de=async s=>{if(!s)return;if((await p.fire({title:"Apakah Anda yakin?",text:"Tindakan ini tidak bisa dibatalkan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#666CFF",cancelButtonColor:"#A7A9B3",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{await r.deleteStockTransfer(s),N(),await p.fire({title:"Berhasil!",text:"Stock Transfer berhasil dihapus.",icon:"success"})}catch(l){await p.fire({title:"Error",text:l.message,icon:"error"})}},q=s=>{switch(s){case"draft":return{text:"Draft",class:"badge rounded-pill bg-label-secondary"};case"approved":return{text:"Approved",class:"badge rounded-pill bg-label-success"}}};return(s,e)=>{const l=ve("Column");return m(),k("div",Be,[a("div",Me,[e[28]||(e[28]=a("h4",{class:"mb-1"},"List Stock Transfer",-1)),e[29]||(e[29]=a("p",{class:"mb-6"}," List stock transfer yang terdaftar di sistem ",-1)),a("div",je,[o(v).total!==void 0?(m(),I(w,{key:0,title:"Total Stock Transfer",total:o(v).total+" Stock Transfer"},null,8,["total"])):g("",!0),o(v).draft!==void 0?(m(),I(w,{key:1,title:"Total Stock Transfer Draft",total:o(v).draft+" Stock Transfer"},null,8,["total"])):g("",!0),o(v).approved!==void 0?(m(),I(w,{key:2,title:"Total Stock Transfer Approved",total:o(v).approved+" Stock Transfer"},null,8,["total"])):g("",!0),o(v).rejected!==void 0?(m(),I(w,{key:3,title:"Total Stock Transfer Rejected",total:o(v).rejected+" Stock Transfer"},null,8,["total"])):g("",!0),i(w,{isAddButtonCard:!0,"image-src":"/img/illustrations/add-new-role-illustration.png","image-alt":"Tambah Stock Transfer","button-text":"Tambah Stock Transfer","modal-target":"#Modal",onButtonClick:e[0]||(e[0]=t=>o(r).openModal())})]),a("div",Ae,[e[21]||(e[21]=a("div",{class:"col-12"},[a("h4",{class:"mt-6 mb-1"},"Total Stock Transfer"),a("p",{class:"mb-0"},"Find all of your company's administrator accounts and their associate Stock Transfer.")],-1)),a("div",De,[a("div",Ee,[a("div",$e,[a("div",Ue,[e[14]||(e[14]=a("span",{class:"me-2"},"Baris:",-1)),i(o(ge),{modelValue:o(b).rows,"onUpdate:modelValue":e[1]||(e[1]=t=>o(b).rows=t),options:te.value,onChange:o(r).handleRowsChange,placeholder:"Jumlah",style:{width:"8rem"}},null,8,["modelValue","options","onChange"])]),a("div",Le,[a("div",Fe,[e[15]||(e[15]=a("button",{class:"btn btn-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[a("i",{class:"ri-upload-2-line me-1"}),c(" Export ")],-1)),a("ul",Re,[a("li",null,[a("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:e[2]||(e[2]=t=>W("csv"))},"CSV")]),a("li",null,[a("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:e[3]||(e[3]=t=>W("pdf"))},"PDF")])])]),a("div",Ne,[a("span",We,[i(o(be),{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=t=>M.value=t),placeholder:"Cari Stock Transfer...",class:"w-full md:w-20rem"},null,8,["modelValue"])])])])]),a("div",qe,[i(Ve,{ref_key:"myDataTableRef",ref:B,data:o(J),rows:o(b).rows,loading:ee.value,totalRecords:o(O),lazy:!0,onPage:o(r).setPagination,responsiveLayout:"scroll",paginatorPosition:"bottom",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} data"},{default:u(()=>[i(l,{header:"#",sortable:!1},{body:u(t=>[c(f(Number.isFinite(o(b).page)&&Number.isFinite(o(b).rows)?(o(b).page-1)*o(b).rows+t.index+1:t.index+1),1)]),_:1}),i(l,{field:"noTransfer",header:"No. Stock Transfer",sortable:!0},{body:u(t=>[a("span",Ge,f(t.data.noTransfer),1)]),_:1}),i(l,{field:"date",header:"Tanggal",sortable:!0,style:{width:"10%"}},{body:u(t=>[c(f(t.data.date?new Date(t.data.date).toLocaleDateString():"-"),1)]),_:1}),i(l,{field:"perusahaan.nmPerusahaan",header:"Perusahaan",sortable:!0,class:"text-nowrap"},{body:u(t=>{var d;return[c(f(((d=t.data.perusahaan)==null?void 0:d.nmPerusahaan)||"-"),1)]}),_:1}),i(l,{field:"cabang.nmCabang",header:"Cabang",sortable:!0,class:"text-nowrap"},{body:u(t=>{var d;return[c(f(((d=t.data.cabang)==null?void 0:d.nmCabang)||"-"),1)]}),_:1}),i(l,{field:"fromWarehouse.name",header:"Gudang Asal",sortable:!0,class:"text-nowrap"},{body:u(t=>{var d;return[c(f(((d=t.data.fromWarehouse)==null?void 0:d.name)||"-"),1)]}),_:1}),i(l,{field:"toWarehouse.name",header:"Gudang Tujuan",sortable:!0,class:"text-nowrap"},{body:u(t=>{var d;return[c(f(((d=t.data.toWarehouse)==null?void 0:d.name)||"-"),1)]}),_:1}),i(l,{field:"status",header:"Status",sortable:!0},{body:u(t=>[a("span",{class:he(q(t.data.status).class)},f(q(t.data.status).text),3)]),_:1}),i(l,{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:u(t=>[a("div",ze,[e[20]||(e[20]=a("a",{href:"javascript:;",class:"btn btn-sm btn-text-secondary rounded-pill btn-icon dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[a("i",{class:"ri-more-2-fill"})],-1)),a("ul",He,[o(x)("approve_stock_transfer")&&t.data.status=="draft"?(m(),k("li",Je,[a("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:d=>le(t.data.id)},e[16]||(e[16]=[a("i",{class:"ri-check-line me-2"},null,-1),c(" Approve ")]),8,Oe)])):g("",!0),o(x)("show_stock_transfer")&&t.data.status=="approved"?(m(),k("li",Ke,[a("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:d=>ie(t.data.id)},e[17]||(e[17]=[a("i",{class:"ri-eye-line me-2"},null,-1),c(" Lihat Detail ")]),8,Ye)])):g("",!0),o(x)("edit_stock_transfer")&&t.data.status=="draft"?(m(),k("li",Qe,[a("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:d=>o(r).openModal(t.data)},e[18]||(e[18]=[a("i",{class:"ri-edit-box-line me-2"},null,-1),c(" Edit ")]),8,Xe)])):g("",!0),o(H)("superadmin")||o(x)("delete_stock_transfer")&&t.data.status=="draft"?(m(),k("li",Ze,[a("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:d=>de(t.data.id)},e[19]||(e[19]=[a("i",{class:"ri-delete-bin-7-line me-2"},null,-1),c(" Hapus ")]),8,ea)])):g("",!0)])])]),_:1})]),_:1},8,["data","rows","loading","totalRecords","onPage"])])])])]),i(Ce,{id:"Modal",isEditMode:o(_),validationErrorsFromParent:o(Y),title:oe.value,description:se.value,selectedStockTransfer:Z.value},{default:u(()=>[a("form",{onSubmit:A(ne,["prevent"])},[a("div",aa,[a("div",ta,[a("div",oa,[D(a("input",{type:"hidden",class:"form-control",id:"name","onUpdate:modelValue":e[5]||(e[5]=t=>o(n).noTransfer=t),placeholder:"Masukkan No. Stock Transfer"},null,512),[[E,o(n).noTransfer]])])]),a("div",sa,[a("div",ra,[i(o(S),{modelValue:o(n).perusahaanId,"onUpdate:modelValue":e[6]||(e[6]=t=>o(n).perusahaanId=t),options:o(X),label:"nmPerusahaan",reduce:t=>t.id,placeholder:"-- Pilih Perusahaan --",class:"perusahaan-select"},null,8,["modelValue","options","reduce"])])]),a("div",na,[a("div",la,[i(o(S),{modelValue:o(n).cabangId,"onUpdate:modelValue":e[7]||(e[7]=t=>o(n).cabangId=t),options:re.value,label:"nmCabang",reduce:t=>t.id,placeholder:"-- Pilih Cabang --",class:"cabang-select"},null,8,["modelValue","options","reduce"])])]),a("div",ia,[a("div",da,[i(o(S),{modelValue:o(n).fromWarehouseId,"onUpdate:modelValue":e[8]||(e[8]=t=>o(n).fromWarehouseId=t),options:o(F),label:"name",reduce:t=>t.id,placeholder:"-- Pilih Gudang Asal --",class:"warehouse-select"},null,8,["modelValue","options","reduce"])])]),a("div",ca,[a("div",ua,[i(o(S),{modelValue:o(n).toWarehouseId,"onUpdate:modelValue":e[9]||(e[9]=t=>o(n).toWarehouseId=t),options:o(F),label:"name",reduce:t=>t.id,placeholder:"-- Pilih Gudang Tujuan --",class:"warehouse-select"},null,8,["modelValue","options","reduce"])])]),a("div",ma,[a("div",fa,[D(a("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[10]||(e[10]=t=>o(n).date=t),placeholder:"Masukkan tanggal",required:""},null,512),[[E,o(n).date]]),e[22]||(e[22]=a("label",{for:"name"},"Tanggal",-1))])]),a("div",pa,[a("div",va,[D(a("input",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[11]||(e[11]=t=>o(n).description=t),placeholder:"Masukkan deskripsi",required:""},null,512),[[E,o(n).description]]),e[23]||(e[23]=a("label",{for:"description"},"Deskripsi",-1))])]),e[27]||(e[27]=a("hr",{class:"mt-7 w-70 justify-content-center"},null,-1)),(m(!0),k(ke,null,_e(o(n).stockTransferItems,(t,d)=>(m(),k("div",{key:d,class:"repeater-item"},[a("div",ga,[a("div",ba,[a("div",ha,[i(o(S),{modelValue:t.stock,"onUpdate:modelValue":h=>t.stock=h,options:o(Q),"get-option-label":h=>{var C;return`${h.product.name} (${(C=h.product.unit)==null?void 0:C.name})`},placeholder:"-- Pilih Produk --"},null,8,["modelValue","onUpdate:modelValue","options","get-option-label"])])]),a("div",ka,[a("div",_a,[a("input",{type:"text",value:t.stock?Math.floor(t.stock.quantity):"",class:"form-control",placeholder:"Stock",readonly:""},null,8,Ta),e[24]||(e[24]=a("label",null,"Stock",-1))])]),a("div",ya,[a("div",wa,[a("input",{type:"text",class:"form-control",placeholder:"Jumlah",value:t.quantity,onInput:h=>{const C=h.target.value.replace(/[^0-9]/g,"");t.quantity=C}},null,40,Sa),e[25]||(e[25]=a("label",null,"Jumlah",-1))])]),a("div",xa,[a("button",{onClick:A(h=>o(r).removeItem(d),["prevent"]),class:"btn btn-outline-danger w-100"},"Hapus",8,Ca)])])]))),128)),a("div",Va,[a("button",{class:"btn btn-sm btn-primary",onClick:e[12]||(e[12]=A(t=>o(r).addItem(),["prevent"]))},e[26]||(e[26]=[a("i",{class:"ri-add-line me-1"},null,-1),a("span",{class:"align-middle"},"Tambah Item",-1)]))]),a("div",Pa,[a("button",Ia,f(o(_)?"Update":"Simpan"),1),a("button",{type:"button",class:"btn btn-secondary",onClick:e[13]||(e[13]=t=>o(r).closeModal())}," Batal ")])])],32)]),_:1},8,["isEditMode","validationErrorsFromParent","title","description","selectedStockTransfer"])]),e[30]||(e[30]=a("div",{class:"content-backdrop fade"},null,-1))])}}},Ja=ce(Ba,[["__scopeId","data-v-40117d90"]]);export{Ja as default};
