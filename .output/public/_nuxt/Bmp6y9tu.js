import{e as c,f as o}from"./Bkm6qw8b.js";const i={id:void 0,kodeCabang:"",nmCabang:"",alamatCabang:"",perusahaanId:void 0},d=c("cabang",{state:()=>({cabangs:[],loading:!1,totalRecords:0,showModal:!1,isEditMode:!1,form:{...i},validationErrors:null,error:null,params:{page:1,rows:10}}),actions:{async fetchCabangs(){var t,e;this.loading=!0,this.error=null;const{$api:a}=o();try{const s=localStorage.getItem("token"),r=new URL(a.cabang());r.searchParams.append("page",this.params.page.toString()),r.searchParams.append("rows",this.params.rows.toString()),this.params.sortField&&(r.searchParams.append("sortField",this.params.sortField),r.searchParams.append("sortOrder",this.params.sortOrder===1?"asc":"desc")),(e=(t=this.params.filters)==null?void 0:t.global)!=null&&e.value&&r.searchParams.append("search",this.params.filters.global.value);const n=await fetch(r,{method:"GET",headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Content-Type":"application/json"},credentials:"include"});if(!n.ok)throw new Error("Gagal mengambil data cabang");const l=await n.json();this.cabangs=l.data,this.totalRecords=l.meta.total}catch(s){console.error("Gagal mengambil data cabang:",s),this.error=s.message}finally{this.loading=!1}},async fetchCabangByPerusahaan(a){if(!a){this.cabangs=[];return}this.loading=!0;const{$api:t}=o(),e=localStorage.getItem("token");try{const r=await(await fetch(t.cabang()+`?perusahaan_id=${a}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}})).json();this.cabangs=r.data||[]}catch(s){console.error("Gagal mengambil data cabang by perusahaan:",s)}finally{this.loading=!1}},async createCabang(){this.loading=!0,this.validationErrors=null;const{$api:a}=o();try{const t=localStorage.getItem("token");await fetch(a.cabang(),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,Accept:"application/json"},body:JSON.stringify(this.form),credentials:"include"}),this.closeModal(),await this.fetchCabangs()}catch(t){t.response&&t.response.status===422?this.validationErrors=t.response._data.errors:console.error("Gagal membuat cabang:",t)}finally{this.loading=!1}},async updateCabang(){if(this.loading=!0,this.validationErrors=null,!this.form.id)return;const{$api:a}=o(),t=localStorage.getItem("token");try{await fetch(a.cabang()+`/${this.form.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,Accept:"application/json"},body:JSON.stringify(this.form),credentials:"include"}),this.closeModal(),await this.fetchCabangs()}catch(e){e.response&&e.response.status===422?this.validationErrors=e.response._data.errors:console.error("Gagal memperbarui cabang:",e)}finally{this.loading=!1}},async deleteCabang(a){this.loading=!0;const{$api:t}=o(),e=localStorage.getItem("token");try{await fetch(t.cabang()+`/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,Accept:"application/json"},credentials:"include"}),await this.fetchCabangs()}catch(s){console.error("Gagal menghapus cabang:",s)}finally{this.loading=!1}},openModal(a){this.validationErrors=null,a?(this.isEditMode=!0,this.form={id:a.id,kodeCabang:a.kodeCabang,nmCabang:a.nmCabang,alamatCabang:a.alamatCabang,perusahaanId:a.perusahaanId}):(this.isEditMode=!1,this.form={...i}),this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={...i}},setPage(a,t){this.params.page=a,this.params.rows=t,this.fetchCabangs()},setSort(a,t){this.params.sortField=a,this.params.sortOrder=t,this.fetchCabangs()},setFilters(a){this.params.filters=a,this.fetchCabangs()}}});export{d as u};
