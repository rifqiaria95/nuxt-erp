import{e as d,f as c}from"./Bkm6qw8b.js";import{S as o}from"./9Qm2jZ7z.js";const p=d("warehouse",{state:()=>({warehouses:[],warehouseList:[],loading:!1,error:null,stats:{total:void 0},totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchWarehouses(){this.loading=!0;const{$api:t}=c();try{const a=localStorage.getItem("token"),e=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),r=await(await fetch(`${t.warehouse()}?${e.toString()}`,{headers:{Accept:"application/json",Authorization:`Bearer ${a}`},credentials:"include"})).json();this.warehouses=r.data,this.totalRecords=r.meta.total}catch(a){console.error("Failed to fetch warehouse:",a),o.fire("Error","Gagal memuat data gudang","error")}finally{this.loading=!1}},async fetchAllWarehouses(){this.loading=!0;const{$api:t}=c();try{const a=localStorage.getItem("token"),s=await(await fetch(`${t.warehouse()}?all=true`,{headers:{Accept:"application/json",Authorization:`Bearer ${a}`},credentials:"include"})).json();this.warehouseList=s.data}catch(a){console.error("Failed to fetch all warehouses:",a),o.fire("Error","Gagal memuat semua data gudang","error")}finally{this.loading=!1}},async fetchStats(){const{$api:t}=c(),a={total:void 0};try{const e=localStorage.getItem("token"),s=await fetch(t.getTotalWarehouse(),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},credentials:"include"});if(s.ok){const r=await s.json();this.stats=r}else this.stats=a}catch(e){console.error("Gagal mengambil data statistik (exception):",e),this.stats=a}},async saveWarehouse(){this.loading=!0,this.validationErrors=[];const{$api:t}=c();try{const s=(await(await fetch(t.csrfToken(),{credentials:"include"})).json()).token,r=localStorage.getItem("token");let h=t.warehouse(),l="POST";this.isEditMode&&this.form.id&&(h=`${t.warehouse()}/${this.form.id}`,l="PUT");const i=await fetch(h,{method:l,headers:{Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(this.form),credentials:"include"});if(!i.ok){const n=await i.json();throw n.errors&&(this.validationErrors=Object.values(n.errors).flat()),new Error(n.message||"Gagal menyimpan data gudang")}this.closeModal(),await this.fetchWarehouses(),await this.fetchStats(),o.fire("Berhasil!",`Gudang berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(a){o.fire("Error",a.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteWarehouse(t){this.loading=!0;const{$api:a}=c();if(!(await o.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const h=(await(await fetch(a.csrfToken(),{credentials:"include"})).json()).token,l=localStorage.getItem("token"),i=await fetch(`${a.warehouse()}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`,Accept:"application/json"},credentials:"include"});if(!i.ok){const n=await i.json();throw new Error(n.message||"Gagal menghapus gudang")}await this.fetchWarehouses(),await this.fetchStats(),o.fire("Berhasil!","Gudang berhasil dihapus.","success")}catch(s){o.fire("Error",s.message||"Gagal menghapus gudang","error")}finally{this.loading=!1}},openModal(t=null){console.log("openModal",t),this.isEditMode=!!t,this.validationErrors=[],t?this.form={...t}:this.form={name:"",address:"",code:"",phone:"",email:""},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(t){this.params.first=t.first,this.params.rows=t.rows,this.fetchWarehouses()},setSort(t){this.params.sortField=t.sortField,this.params.sortOrder=t.sortOrder,this.fetchWarehouses()},setSearch(t){this.params.search=t,this.params.first=0,this.fetchWarehouses()}}});export{p as u};
