import{e as K,f as y,_ as Y,j as E,s as Q,k as V,g as W,l as j,c as C,a as e,b as u,m as _,n as v,i as s,d as X,w as U,r as Z,o as p,q as tt,v as et,F as st,x as at,t as $,y as ot,z as rt,A as M,B as T}from"./Bkm6qw8b.js";import{_ as it}from"./BAMzpvu1.js";import{_ as lt}from"./DleeVanq.js";import{_ as k}from"./CdgIhitS.js";import{S as h}from"./9Qm2jZ7z.js";import{C as R}from"./D9zIpW-x.js";import{u as nt}from"./CI-DMe-d.js";import"./D1pefl20.js";const dt=K("user-management",{state:()=>({users:[],roles:[],loading:!1,error:null,stats:{total:void 0,aktif:void 0,tidakAktif:void 0,totalSuperadmin:void 0,totalAdmin:void 0},totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchUsers(){this.loading=!0;const{$api:r}=y();try{const i=localStorage.getItem("token"),o=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),l=await fetch(`${r.users()}?${o.toString()}`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!l.ok)throw new Error("Gagal memuat data user");const d=await l.json();this.users=d.data||[],this.totalRecords=parseInt(d.meta.total)||0}catch(i){this.error=i.message,h.fire("Error",`Tidak dapat memuat data user: ${i.message}`,"error")}finally{this.loading=!1}},async fetchRoles(){const{$api:r}=y();try{const i=localStorage.getItem("token"),o=await fetch(r.roles(),{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},credentials:"include"});if(!o.ok)throw new Error("Gagal mengambil data role");const l=await o.json();this.roles=l.data||l}catch(i){console.error("Error fetching role:",i),h.fire("Error",`Tidak dapat memuat data role: ${i.message}`,"error")}},async fetchStats(){const{$api:r}=y(),i={total:void 0,aktif:void 0,tidakAktif:void 0,totalSuperadmin:void 0,totalAdmin:void 0};try{const o=localStorage.getItem("token"),l=await fetch(r.countTotalUsers(),{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},credentials:"include"});if(l.ok){const d=await l.json();this.stats=d}else this.stats=i}catch(o){console.error("Gagal mengambil data statistik (exception):",o),this.stats=i}},async saveUser(){this.loading=!0,this.validationErrors=[];const{$api:r}=y();try{const i=localStorage.getItem("token");let o=r.users(),l="POST";const d={full_name:this.form.full_name,email:this.form.email,isActive:this.form.isActive,role_ids:this.form.role_ids};this.isEditMode&&this.form.id?(o=`${r.users()}/${this.form.id}`,l="PUT",this.form.password&&(d.password=this.form.password)):d.password=this.form.password;const g=await fetch(o,{method:l,headers:{Authorization:`Bearer ${i}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"});if(!g.ok){const n=await g.json();throw n.errors&&(this.validationErrors=Object.values(n.errors).flat()),new Error(n.message||"Gagal menyimpan data user")}this.closeModal(),await this.fetchUsers(),await this.fetchStats(),h.fire("Berhasil!",`User berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(i){h.fire("Error",i.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteUser(r){this.loading=!0;const{$api:i}=y();if(!(await h.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const l=localStorage.getItem("token"),d=await fetch(`${i.users()}/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`,Accept:"application/json"},credentials:"include"});if(!d.ok){const g=await d.json();throw new Error(g.message||"Gagal menghapus user")}await this.fetchUsers(),await this.fetchStats(),h.fire("Berhasil!","User berhasil dihapus.","success")}catch(l){h.fire("Error",l.message||"Gagal menghapus user","error")}finally{this.loading=!1}},openModal(r=null){this.isEditMode=!!r,this.validationErrors=[],r?this.form={...r,full_name:r.fullName,role_ids:r.roles.map(i=>i.id)}:this.form={full_name:"",email:"",password:"",isActive:!0,role_ids:[]},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(r){this.params.first=r.first,this.params.rows=r.rows,this.fetchUsers()},setSort(r){this.params.sortField=r.sortField,this.params.sortOrder=r.sortOrder,this.params.first=0,this.fetchUsers()},setSearch(r){this.params.search=r,this.params.first=0,this.fetchUsers()}}}),mt={class:"content-wrapper"},ut={class:"container-xxl flex-grow-1 container-p-y"},ct={class:"row g-6 mb-6"},pt={class:"row g-6"},ft={class:"col-12"},ht={class:"card"},gt={class:"card-header d-flex justify-content-between align-items-center flex-wrap"},bt={class:"d-flex align-items-center me-3 mb-2 mb-md-0"},vt={class:"d-flex align-items-center"},kt={class:"btn-group me-2"},wt={class:"dropdown-menu"},yt={class:"input-group"},_t={class:"p-input-icon-left"},Ut={class:"card-datatable table-responsive py-3 px-3"},St=["onClick"],At=["onClick"],xt={class:"row g-6"},Et={class:"col-md-12"},Ct={class:"form-floating form-floating-outline"},$t={class:"col-md-6"},Mt={class:"form-floating form-floating-outline"},Tt={class:"col-md-6"},Bt={class:"form-floating form-floating-outline"},Pt={key:0,id:"passwordHelp",class:"form-text"},Vt={class:"col-md-6"},jt={class:"col-md-6"},Rt={class:"d-flex justify-content-end"},Ft={type:"submit",class:"btn btn-primary me-2"},Lt={__name:"user",setup(r){const i=E(null),o=dt(),{users:l,roles:d,loading:g,stats:n,totalRecords:F,params:S,form:c,isEditMode:w,showModal:L,validationErrors:D}=Q(o),A=E(""),N=E([{label:"Aktif",value:!0},{label:"Tidak Aktif",value:!1}]),O=E([10,25,50,100]),z=V(()=>w.value?"Edit User":"Tambah User"),G=V(()=>w.value?"Silakan ubah data user di bawah ini.":"Silakan isi form di bawah ini untuk menambahkan user baru.");let f=null;W(()=>{o.fetchUsers(),o.fetchRoles(),o.fetchStats();const m=document.getElementById("UserModal");m&&(f=new bootstrap.Modal(m))}),j(L,m=>{m?f==null||f.show():f==null||f.hide()});const I=nt(()=>{o.setSearch(A.value)},500);j(A,I);const q=m=>o.setPagination(m),H=()=>{S.value.first=0,o.fetchUsers()},J=m=>o.setSort(m),B=m=>{m==="csv"&&i.value.exportCSV()},P=m=>{switch(m){case!0:return{text:"Aktif",class:"badge rounded-pill bg-label-primary"};case!1:return{text:"Tidak Aktif",class:"badge rounded-pill bg-label-danger"};default:return{text:"-",class:"badge rounded-pill bg-label-light"}}};return(m,t)=>{const b=Z("Column");return p(),C("div",mt,[e("div",ut,[t[22]||(t[22]=e("h4",{class:"mb-1"},"List User",-1)),t[23]||(t[23]=e("p",{class:"mb-6"}," List User yang terdaftar di sistem ",-1)),e("div",ct,[s(n).total!==void 0?(p(),_(k,{key:0,title:"Total User",total:s(n).total+" User"},null,8,["total"])):v("",!0),s(n).aktif!==void 0?(p(),_(k,{key:1,title:"User Aktif",total:s(n).aktif+" User"},null,8,["total"])):v("",!0),s(n).tidakAktif!==void 0?(p(),_(k,{key:2,title:"User Tidak Aktif",total:s(n).tidakAktif+" User"},null,8,["total"])):v("",!0),s(n).totalSuperadmin!==void 0?(p(),_(k,{key:3,title:"User Superadmin",total:s(n).totalSuperadmin+" User"},null,8,["total"])):v("",!0),s(n).totalAdmin!==void 0?(p(),_(k,{key:4,title:"User Admin",total:s(n).totalAdmin+" User"},null,8,["total"])):v("",!0),u(k,{isAddButtonCard:!0,"image-src":"/img/illustrations/add-new-role-illustration.png","image-alt":"Tambah User","button-text":"Tambah User",onButtonClick:t[0]||(t[0]=a=>s(o).openModal())})]),e("div",pt,[t[18]||(t[18]=e("div",{class:"col-12"},[e("h4",{class:"mt-6 mb-1"},"Filter & Daftar User"),e("p",{class:"mb-0"},"Cari dan kelola semua akun administrator perusahaan Anda beserta detailnya.")],-1)),e("div",ft,[e("div",ht,[e("div",gt,[e("div",bt,[t[14]||(t[14]=e("span",{class:"me-2"},"Baris:",-1)),u(s(tt),{modelValue:s(S).rows,"onUpdate:modelValue":t[1]||(t[1]=a=>s(S).rows=a),options:O.value,onChange:H,placeholder:"Jumlah",style:{width:"8rem"}},null,8,["modelValue","options"])]),e("div",vt,[e("div",kt,[t[15]||(t[15]=e("button",{class:"btn btn-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"ri-upload-2-line me-1"}),X(" Export ")],-1)),e("ul",wt,[e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:t[2]||(t[2]=a=>B("csv"))},"CSV")]),e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:t[3]||(t[3]=a=>B("pdf"))},"PDF")])])]),e("div",yt,[e("span",_t,[u(s(et),{modelValue:A.value,"onUpdate:modelValue":t[4]||(t[4]=a=>A.value=a),placeholder:"Cari user...",class:"w-full md:w-20rem"},null,8,["modelValue"])])])])]),e("div",Ut,[u(lt,{ref_key:"myDataTableRef",ref:i,data:s(l),rows:s(S).rows,loading:s(g),totalRecords:s(F),lazy:!0,onPage:t[5]||(t[5]=a=>q(a)),onSort:t[6]||(t[6]=a=>J(a)),responsiveLayout:"scroll",paginatorPosition:"bottom",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} data"},{default:U(()=>[u(b,{field:"id",header:"#",sortable:!0}),u(b,{field:"fullName",header:"Nama Lengkap",sortable:!0}),u(b,{field:"email",header:"Email",sortable:!0}),u(b,{field:"roles",header:"Role",sortable:!1},{body:U(a=>[(p(!0),C(st,null,at(a.data.roles,x=>(p(),C("span",{key:x.id},$(x.name),1))),128))]),_:1}),u(b,{field:"isActive",header:"Status",sortable:!0},{body:U(a=>[e("span",{class:ot(P(a.data.isActive).class)},$(P(a.data.isActive).text),3)]),_:1}),u(b,{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:U(a=>[e("button",{onClick:x=>s(o).openModal(a.data),class:"btn btn-sm btn-icon btn-text-secondary rounded-pill btn-icon me-2"},t[16]||(t[16]=[e("i",{class:"ri-edit-box-line"},null,-1)]),8,St),e("button",{onClick:x=>s(o).deleteUser(a.data.id),class:"btn btn-sm btn-icon btn-text-secondary rounded-pill btn-icon"},t[17]||(t[17]=[e("i",{class:"ri-delete-bin-7-line"},null,-1)]),8,At)]),_:1})]),_:1},8,["data","rows","loading","totalRecords"])])])])]),u(it,{id:"UserModal",isEditMode:s(w),validationErrorsFromParent:s(D),title:z.value,description:G.value},{default:U(()=>[e("form",{onSubmit:t[13]||(t[13]=rt(a=>s(o).saveUser(),["prevent"]))},[e("div",xt,[e("div",Et,[e("div",Ct,[M(e("input",{type:"text",class:"form-control",id:"full_name","onUpdate:modelValue":t[7]||(t[7]=a=>s(c).full_name=a),placeholder:"Masukkan nama user",required:""},null,512),[[T,s(c).full_name]]),t[19]||(t[19]=e("label",{for:"full_name"},"Nama Lengkap",-1))])]),e("div",$t,[e("div",Mt,[M(e("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[8]||(t[8]=a=>s(c).email=a),placeholder:"Masukkan email"},null,512),[[T,s(c).email]]),t[20]||(t[20]=e("label",{for:"email"},"Email",-1))])]),e("div",Tt,[e("div",Bt,[M(e("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[9]||(t[9]=a=>s(c).password=a),placeholder:"Masukkan password","aria-describedby":"passwordHelp"},null,512),[[T,s(c).password]]),t[21]||(t[21]=e("label",{for:"password"},"Password",-1))]),s(w)?(p(),C("div",Pt," Kosongkan jika tidak ingin mengubah password. ")):v("",!0)]),e("div",Vt,[u(s(R),{modelValue:s(c).role_ids,"onUpdate:modelValue":t[10]||(t[10]=a=>s(c).role_ids=a),options:s(d),label:"name",multiple:"",reduce:a=>a.id,placeholder:"-- Pilih Role --",id:"role_ids",class:"role_ids"},null,8,["modelValue","options","reduce"])]),e("div",jt,[u(s(R),{modelValue:s(c).isActive,"onUpdate:modelValue":t[11]||(t[11]=a=>s(c).isActive=a),options:N.value,label:"label",reduce:a=>a.value,placeholder:"-- Pilih Status --",id:"isActive",class:"isActive"},null,8,["modelValue","options","reduce"])]),e("div",Rt,[e("button",Ft,$(s(w)?"Update":"Simpan"),1),e("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=a=>s(o).closeModal())}," Batal ")])])],32)]),_:1},8,["isEditMode","validationErrorsFromParent","title","description"])]),t[24]||(t[24]=e("div",{class:"content-backdrop fade"},null,-1))])}}},Jt=Y(Lt,[["__scopeId","data-v-5e6e1778"]]);export{Jt as default};
