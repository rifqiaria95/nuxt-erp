import{e as f,f as l}from"./Bkm6qw8b.js";import{S as c}from"./9Qm2jZ7z.js";const u=f("vendor",{state:()=>({vendors:[],loading:!1,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchVendors(){this.loading=!0,this.error=null;const{$api:t}=l();try{const o=(await(await fetch(t.csrfToken(),{credentials:"include"})).json()).token,d=localStorage.getItem("token");if(!o)throw new Error("CSRF token not found. Cannot proceed with request.");const a=new URL(t.vendor()),i=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${d}`,Accept:"application/json","Content-Type":"application/json"},credentials:"include"}),n=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""});if(!i.ok)throw new Error("Gagal mengambil data vendor");const e=await i.json();this.vendors=e.data,this.totalRecords=e.meta.total}catch(r){this.error=r.message,c.fire("Error",`Tidak dapat memuat data vendor: ${r.message}`,"error")}finally{this.loading=!1}},async saveVendor(){this.loading=!0,this.validationErrors=[];const{$api:t}=l();try{const o=(await(await fetch(t.csrfToken(),{credentials:"include"})).json()).token,d=localStorage.getItem("token");if(!o)throw new Error("CSRF token tidak ditemukan. Tidak dapat melanjutkan request.");const a=new FormData;Object.keys(this.form).forEach(s=>{s!=="logo"&&this.form[s]!==null&&this.form[s]!==void 0&&a.append(s,this.form[s])}),this.form.logo instanceof File&&a.append("logo",this.form.logo);let i="POST",n=t.vendor();this.isEditMode&&(n=`${t.vendor()}/${this.form.id}`,a.append("_method","PUT"));const e=await fetch(n,{method:i,headers:{Authorization:`Bearer ${d}`,Accept:"application/json"},body:a,credentials:"include"});if(!e.ok)if(e.status===422){const s=await e.json();this.validationErrors=Object.values(s.errors).flat();return}else{const s=await e.json();throw new Error(s.message||"Gagal menyimpan data vendor")}this.closeModal(),await this.fetchVendors(),c.fire("Berhasil!",`Vendor berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(r){c.fire("Error",r.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteVendor(t){this.loading=!0;const{$api:r}=l();if((await c.fire({title:"Apakah Anda yakin?",text:"Data vendor yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const a=(await(await fetch(r.csrfToken(),{credentials:"include"})).json()).token,i=localStorage.getItem("token");if(!a)throw new Error("CSRF token tidak ditemukan. Tidak dapat melanjutkan request.");const n=await fetch(r.vendor()+`/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`,Accept:"application/json"},credentials:"include"});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal menghapus vendor")}await this.fetchVendors(),c.fire("Berhasil!","Vendor berhasil dihapus.","success")}catch(o){console.error("Gagal menghapus vendor:",o),c.fire("Error",o.message||"Gagal menghapus vendor","error")}finally{this.loading=!1}},openModal(t=null){this.isEditMode=!!t,this.validationErrors=[],t?this.form={...t,logo:null}:this.form={name:"",address:"",email:"",phone:"",npwp:"",logo:null},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(t){this.params.first=t.first,this.params.rows=t.rows,this.fetchVendors()},setSort(t){this.params.sortField=t.sortField,this.params.sortOrder=t.sortOrder,this.fetchVendors()},setSearch(t){this.params.search=t,this.params.first=0,this.fetchVendors()}}});export{u};
