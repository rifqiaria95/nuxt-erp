import{e as l,f as i}from"./Bkm6qw8b.js";import{S as s}from"./9Qm2jZ7z.js";const d=l("kategori",{state:()=>({kategori:[],loading:!1,error:null,stats:{total:void 0,sparepart:void 0,oli:void 0,alat_berat:void 0,tooling:void 0},totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchKategori(){this.loading=!0,this.error=null;const{$api:t}=i();try{const e=localStorage.getItem("token"),o=new URL(t.categories()),a=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"},credentials:"include"});if(!a.ok)throw new Error("Gagal mengambil data kategori");const r=await a.json(),n=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""});this.kategori=r.data,this.totalRecords=r.meta.total}catch(e){this.error=e.message,s.fire("Error",`Tidak dapat memuat data kategori: ${e.message}`,"error")}finally{this.loading=!1}},async fetchStats(){const{$api:t}=i(),e={total:void 0,sparepart:void 0,oli:void 0,alat_berat:void 0,tooling:void 0};try{const o=localStorage.getItem("token"),a=await fetch(t.countProductByCategory(),{method:"GET",headers:{Authorization:`Bearer ${o}`,Accept:"application/json","Content-Type":"application/json"},credentials:"include"});if(!a.ok)throw new Error("Gagal mengambil data statistik");const r=await a.json();this.stats=r}catch(o){console.error("Gagal mengambil data statistik (exception):",o),this.stats=e}},async saveKategori(){this.loading=!0,this.validationErrors=[];const{$api:t}=i();try{const e=localStorage.getItem("token");let o=t.categories(),a="POST";this.isEditMode&&this.form.id&&(o=`${t.categories()}/${this.form.id}`,a="PUT");const r=await fetch(o,{method:a,headers:{Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(this.form),credentials:"include"});if(!r.ok)throw r.status===404?new Error("Endpoint tidak ditemukan. Pastikan endpoint dan method sudah benar."):new Error("Gagal menyimpan data kategori");const n=await r.json();this.closeModal(),await this.fetchKategori(),await this.fetchStats(),s.fire("Berhasil!",`Kategori berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(e){s.fire("Error",e.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteKategori(t){this.loading=!0;const{$api:e}=i();if((await s.fire({title:"Apakah Anda yakin?",text:"Data kategori yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const a=localStorage.getItem("token"),r=await fetch(e.categories()+`/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,Accept:"application/json"},credentials:"include"});if(!r.ok){const n=await r.json();throw new Error(n.message||"Gagal menghapus kategori")}await this.fetchKategori(),s.fire("Berhasil!","Kategori berhasil dihapus.","success")}catch(a){console.error("Gagal menghapus kategori:",a),s.fire("Error",a.message||"Gagal menghapus kategori","error")}finally{this.loading=!1}},openModal(t=null){this.isEditMode=!!t,this.validationErrors=[],t?this.form={...t}:this.form={name:"",description:""},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(t){this.params.first=t.first,this.params.rows=t.rows,this.fetchKategori()},setSort(t){this.params.sortField=t.sortField,this.params.sortOrder=t.sortOrder,this.fetchKategori()},setSearch(t){this.params.search=t,this.params.first=0,this.fetchKategori()}}});export{d as u};
