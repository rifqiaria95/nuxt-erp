import{e as l,f as h}from"./Bkm6qw8b.js";import{S as i}from"./9Qm2jZ7z.js";const u=l("perusahaan",{state:()=>({perusahaans:[],loading:!0,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[],selectedPerusahaan:null}),actions:{async fetchPerusahaans(){this.loading=!0;const{$api:a}=h();try{const r=localStorage.getItem("token"),o=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),e=await(await fetch(`${a.perusahaan()}?${o.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${r}`,Accept:"application/json"},credentials:"include"})).json();this.perusahaans=e.data,this.totalRecords=e.meta.total}catch(r){console.error("Gagal mengambil data perusahaan:",r),i.fire("Error","Gagal memuat data perusahaan","error")}finally{this.loading=!1}},async savePerusahaan(){this.loading=!0,this.validationErrors=[];const{$api:a}=h();try{const r=localStorage.getItem("token"),o=new FormData;Object.keys(this.form).forEach(s=>{s==="logoPerusahaan"&&this.form[s]instanceof File?o.append(s,this.form[s]):this.form[s]!==null&&this.form[s]!==void 0&&o.append(s,this.form[s])});let t=a.perusahaan(),e="POST";this.isEditMode&&this.form.id&&(t=`${a.perusahaan()}/${this.form.id}`);const n=await fetch(t,{method:e,headers:{Authorization:`Bearer ${r}`,Accept:"application/json"},body:o,credentials:"include"});if(!n.ok){const s=await n.json();throw s.errors&&(this.validationErrors=Object.values(s.errors).flat()),new Error(s.message||"Gagal menyimpan data perusahaan")}this.closeModal(),await this.fetchPerusahaans(),i.fire("Berhasil!",`Perusahaan berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(r){i.fire("Error",r.message||"Operasi gagal","error")}finally{this.loading=!1}},async deletePerusahaan(a){this.loading=!0;const{$api:r}=h();if(!(await i.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const t=localStorage.getItem("token"),e=await fetch(`${r.perusahaan()}/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,Accept:"application/json"},credentials:"include"});if(!e.ok){const n=await e.json();throw new Error(n.message||"Gagal menghapus perusahaan")}await this.fetchPerusahaans(),i.fire("Berhasil!","Perusahaan berhasil dihapus.","success")}catch(t){i.fire("Error",t.message||"Gagal menghapus perusahaan","error")}finally{this.loading=!1}},openModal(a=null){this.isEditMode=!!a,this.validationErrors=[],a?this.form={...a}:this.form={kodePerusahaan:"",nmPerusahaan:"",npwpPerusahaan:"",alamatPerusahaan:"",tlpPerusahaan:"",emailPerusahaan:"",logoPerusahaan:null},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[],this.selectedPerusahaan=null},setPagination(a){this.params.first=a.first,this.params.rows=a.rows,this.fetchPerusahaans()},setSort(a){this.params.sortField=a.sortField,this.params.sortOrder=a.sortOrder,this.fetchPerusahaans()},setSearch(a){this.params.search=a,this.params.first=0,this.fetchPerusahaans()},setLogo(a){this.form.logoPerusahaan=a}}});export{u};
