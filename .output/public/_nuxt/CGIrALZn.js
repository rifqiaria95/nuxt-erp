import{e as h,f as l}from"./Bkm6qw8b.js";import{S as d}from"./9Qm2jZ7z.js";const m=h("product",{state:()=>({products:[],loading:!0,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:"",warehouseId:null},form:{name:"",sku:"",unitId:void 0,stockMin:0,priceBuy:0,priceSell:0,isService:!1,image:"",categoryId:void 0,kondisi:"baru"},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchProducts(){this.loading=!0,this.error=null;const{$api:t}=l();try{const s=localStorage.getItem("token"),r=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"id",sortOrder:this.params.sortOrder===-1?"desc":"asc",search:this.params.search||""});this.params.warehouseId&&r.append("warehouseId",this.params.warehouseId.toString());const a=await fetch(`${t.product()}?${r.toString()}`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!a.ok){const i=await a.json().catch(()=>({message:"Gagal memuat data produk dengan status: "+a.status}));throw new Error(i.message||"Gagal memuat data produk")}const o=await a.json();this.products=o.data,this.totalRecords=o.meta.total}catch(s){this.error=s.message,d.fire("Error",`Tidak dapat memuat data produk: ${s.message}`,"error")}finally{this.loading=!1}},async saveProduct(){this.loading=!0,this.validationErrors=[];const{$api:t}=l();try{const s=localStorage.getItem("token"),r=new FormData;Object.keys(this.form).forEach(e=>{const n=this.form[e];e==="isService"?r.append(e,n?"true":"false"):n!=null&&(e==="image"&&n instanceof File?r.append(e,n):e!=="image"&&r.append(e,String(n)))});let a=t.product(),o="POST";this.isEditMode&&this.form.id&&(a=`${t.product()}/${this.form.id}`,r.append("_method","PUT"));const i=await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${s}`,Accept:"application/json"},body:r,credentials:"include"}),c=await i.json();if(!i.ok)throw c.errors&&(this.validationErrors=Object.values(c.errors).flat()),new Error(c.message||"Gagal menyimpan data produk");this.closeModal(),await this.fetchProducts(),d.fire("Berhasil!",`Produk berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(s){d.fire("Error",s.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteProduct(t){const{$api:s}=l();if((await d.fire({title:"Apakah Anda yakin?",text:"Data produk yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!0;try{const a=localStorage.getItem("token"),o=await fetch(s.product()+`/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,Accept:"application/json"},credentials:"include"});if(!o.ok){const i=await o.json();throw new Error(i.message||"Gagal menghapus produk")}await this.fetchProducts(),d.fire("Berhasil!","Produk berhasil dihapus.","success")}catch(a){console.error("Gagal menghapus produk:",a),d.fire("Error",a.message||"Gagal menghapus produk","error")}finally{this.loading=!1}}},openModal(t=null){this.isEditMode=!!t,this.validationErrors=[],t?this.form={...t,stockMin:t.stockMin?Math.round(t.stockMin):0}:this.form={name:"",sku:"",unitId:void 0,stockMin:0,priceBuy:0,priceSell:0,isService:!1,image:"",categoryId:void 0,kondisi:"baru"},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(t){this.params.first=t.first,this.params.rows=t.rows,this.fetchProducts()},setSort(t){this.params.sortField=t.sortField,this.params.sortOrder=t.sortOrder,this.fetchProducts()},setSearch(t){this.params.search=t,this.params.first=0,this.fetchProducts()},setWarehouseFilter(t){this.params.warehouseId=t,this.params.first=0,this.fetchProducts()},handleImageChange(t){t&&(this.form.image=t)}}});export{m as u};
