import{e as d,f as l}from"./Bkm6qw8b.js";import{S as o}from"./9Qm2jZ7z.js";const m=d("divisi",{state:()=>({divisis:[],loading:!1,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchDivisis(){var s;this.loading=!0,this.error=null;const{$api:i}=l();try{const t=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"id",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),a=localStorage.getItem("token"),e=await fetch(`${i.divisi()}?${t.toString()}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(!e.ok)throw new Error("Gagal mengambil data divisi");const r=await e.json();this.divisis=r.data.map(n=>({id:n.id,nmDivisi:n.nmDivisi}))||[],this.totalRecords=((s=r.meta)==null?void 0:s.total)||0}catch(t){this.error=t.message,o.fire("Error",`Tidak dapat memuat data divisi: ${t.message}`,"error")}finally{this.loading=!1}},async saveDivisi(){this.loading=!0,this.validationErrors=[];const{$api:i}=l();try{const s=localStorage.getItem("token");let t=i.divisi(),a="POST";const e=JSON.stringify({nmDivisi:this.form.nmDivisi});this.isEditMode&&this.form.id&&(t=`${i.divisi()}/${this.form.id}`,a="PUT");const r=await fetch(t,{method:a,headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Content-Type":"application/json"},body:e,credentials:"include"});if(!r.ok){const n=await r.json();throw r.status===422?(this.validationErrors=Object.values(n.errors).flat(),new Error("Data validasi tidak valid")):new Error(n.message||"Gagal menyimpan data divisi")}this.closeModal(),await this.fetchDivisis(),o.fire("Berhasil!",`Divisi berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(s){s.message!=="Data validasi tidak valid"&&o.fire("Error",s.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteDivisi(i){this.loading=!0;const{$api:s}=l();if(!(await o.fire({title:"Apakah Anda yakin?",text:"Data divisi yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const a=localStorage.getItem("token"),e=await fetch(`${s.divisi()}/${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,Accept:"application/json"},credentials:"include"});if(!e.ok){const r=await e.json();throw new Error(r.message||"Gagal menghapus divisi")}await this.fetchDivisis(),o.fire("Berhasil!","Divisi berhasil dihapus.","success")}catch(a){console.error("Gagal menghapus divisi:",a),o.fire("Error",a.message||"Gagal menghapus divisi","error")}finally{this.loading=!1}},openModal(i=null){this.isEditMode=!!i,this.validationErrors=[],i?this.form={...i}:this.form={nmDivisi:""},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(i){this.params.first=i.first,this.params.rows=i.rows,this.fetchDivisis()},setSort(i){this.params.sortField=i.sortField,this.params.sortOrder=i.sortOrder,this.fetchDivisis()},setSearch(i){this.params.search=i,this.params.first=0,this.fetchDivisis()}}});export{m as u};
