import{_ as me,f as ce,j as r,M as pe,N as fe,l as U,K as ve,k as j,g as ge,c as u,a as t,F as L,b as m,m as J,n as be,x as q,i as D,d as x,w,r as ye,o as i,q as he,v as we,t as S,y as ke,z as Pe,A as _e,B as Ce}from"./Bkm6qw8b.js";import{_ as De}from"./X_GiR0ue.js";import{_ as Ie}from"./BAMzpvu1.js";import{_ as F}from"./CdgIhitS.js";import{_ as xe}from"./DleeVanq.js";import{u as Se}from"./VXGyPOT6.js";import{C as K}from"./D9zIpW-x.js";import{S as f}from"./9Qm2jZ7z.js";import"./D1pefl20.js";const Te={class:"content-wrapper"},Ge={class:"container-xxl flex-grow-1 container-p-y"},Ae={key:0,class:"text-center"},Me={key:0},Ee={class:"row g-6 mb-6"},Be={class:"row g-6"},je={class:"col-12"},Le={class:"card"},Fe={class:"card-header d-flex justify-content-between align-items-center flex-wrap"},$e={class:"d-flex align-items-center me-3 mb-2 mb-md-0"},Re={class:"d-flex align-items-center"},Ve={class:"btn-group me-2"},Ne={class:"dropdown-menu"},Oe={class:"input-group"},ze={class:"p-input-icon-left"},Ue={class:"card-datatable table-responsive py-3 px-3"},Je={key:0},qe={key:1},Ke={key:0},Ye={key:1},He={key:1},Qe=["onClick"],We=["onClick"],Xe={key:1,class:"text-center"},Ze={class:"d-flex flex-column align-items-center"},ea={class:"row g-3"},aa={class:"col-12 mb-3"},ta={class:"col-6 mb-3"},sa={class:"col-6 mb-3"},oa={class:"col-12 d-flex flex-wrap justify-content-center gap-4 row-gap-4"},na={type:"submit",class:"btn btn-primary"},la={__name:"permissions",setup(ra){const{$api:c}=ce(),T=r(null),G=r(""),$=Se(),y=pe(),I=r([]),A=r(0),R=r(!1),l=r({first:0,rows:10,sortField:"id",sortOrder:"desc",search:"",draw:1}),v=r({total:void 0,roles:[]}),V=r({global:{value:null,matchMode:fe.CONTAINS}});let k=null;U(G,a=>{V.value.global.value=a,k&&clearTimeout(k),k=setTimeout(()=>{l.value.search=a,l.value.first=0,b()},500)}),ve(()=>{k&&clearTimeout(k)});const g=r(!1),Y=r(null),M=r([]),N=r([]),P=r([]),n=r({id:null,name:"",menuGroupId:null,menuDetailId:null}),H=r([{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}]),Q=j(()=>g.value?"Edit Permission":"Tambah Permission"),W=j(()=>g.value?"Silakan ubah data permission di bawah ini.":"Silakan isi form di bawah ini untuk menambahkan permission baru."),O=()=>{const a=document.getElementById("PermissionModal");a&&(bootstrap.Modal.getInstance(a).hide(),a.addEventListener("hidden.bs.modal",()=>{document.querySelectorAll(".modal-backdrop").forEach(o=>o.remove()),document.body.style.overflow=""},{once:!0})),E()},E=()=>{n.value={id:null,name:"",menuGroupId:null,menuDetailId:null},M.value=[]},X=async()=>{try{const a=new URLSearchParams({draw:l.value.draw.toString(),start:l.value.first.toString(),length:l.value.rows.toString(),search:l.value.search||"",sortField:l.value.sortField||"id",sortOrder:l.value.sortOrder||"desc"}),e=await fetch(`${c.permissions()}?${a.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("Gagal mengambil data permissions");const o=await e.json();I.value=o.data||[],A.value=parseInt(o.recordsFiltered??o.recordsTotal??0,10),o.draw&&(l.value.draw=parseInt(o.draw))}catch(a){throw console.error("Gagal mengambil data permissions:",a),I.value=[],A.value=0,a}},Z=async()=>{const a={total:void 0,roles:[]};try{const e=await fetch(c.getTotalPermission(),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(e.ok){const o=await e.json();o&&typeof o=="object"&&o!==null?v.value={total:o.total,roles:o.roles}:(v.value=a,console.warn("Data statistik dari API tidak dalam format objek yang diharapkan atau null:",o))}else v.value=a,console.error("Gagal mengambil data statistik, status respons:",e.status)}catch(e){console.error("Gagal mengambil data statistik (exception):",e),v.value=a}},ee=async()=>{var a;y.setLoading(!0);try{const s=(await(await fetch(c.csrfToken(),{credentials:"include"})).json()).token||((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content),d=localStorage.getItem("token");let _,h;const C={name:n.value.name,menuGroupIds:n.value.menuGroupId?[n.value.menuGroupId]:[],menuDetailIds:n.value.menuDetailId?[n.value.menuDetailId]:[]};if(g.value){const p=n.value.id;if(!p){f.fire("Error","ID Permission tidak ditemukan untuk update.","error");return}h=c.permissionUpdate(p),_=await fetch(h,{method:"PUT",body:JSON.stringify(C),headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},credentials:"include"})}else h=c.permissionStore(),_=await fetch(h,{method:"POST",body:JSON.stringify(C),headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},credentials:"include"});if(_.ok)await b(),O(),$.fetchPermissions(),await f.fire("Berhasil!",`Permission berhasil ${g.value?"diperbarui":"dibuat"}.`,"success");else{const p=await _.json();p.errors?M.value=Object.values(p.errors).flat():f.fire("Gagal",p.message||"Gagal menyimpan permission","error")}}catch(e){f.fire("Error",e.message||"Terjadi kesalahan saat menyimpan data.","error")}finally{y.setLoading(!1)}},ae=a=>{l.value.first=a.first,l.value.rows=a.rows,b()},te=()=>{l.value.first=0,b()},se=a=>{l.value.sortField=a.sortField,l.value.sortOrder=a.sortOrder===1?"asc":"desc",b()},z=a=>{a==="csv"?T.value.exportCSV():a==="pdf"&&T.value.exportPDF()},oe=a=>({1:"bg-label-primary",2:"bg-label-warning",3:"bg-label-success"})[a]||"bg-label-info",ne=async()=>{try{const a=localStorage.getItem("token"),e=await fetch(c.menuGroups(),{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error("Gagal mengambil data menu groups");const o=await e.json();N.value=o.data||o}catch(a){console.error("Error fetching menu groups:",a)}},B=async a=>{if(!a){P.value=[];return}try{const e=localStorage.getItem("token"),o=await fetch(c.getMenuDetails(a),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error("Gagal mengambil data menu details");const s=await o.json();P.value=Array.isArray(s.menuDetails)?s.menuDetails:[]}catch(e){console.error("Error fetching menu details:",e),P.value=[]}};ge(()=>{b()});const b=async()=>{y.setLoading(!0);try{await X(),Z(),ue()}catch(a){console.error("Gagal memuat data halaman:",a),f.fire("Error","Gagal memuat data halaman.","error")}finally{y.setLoading(!1)}};function le(){g.value=!1,E();const a=document.getElementById("PermissionModal");a&&bootstrap.Modal.getOrCreateInstance(a).show()}async function re(a){g.value=!0,E(),Y.value=JSON.parse(JSON.stringify(a)),n.value={id:a.id,name:a.name||"",menuGroupId:a.menuGroups&&a.menuGroups.length>0?a.menuGroups[0].id:null,menuDetailId:a.menuDetails&&a.menuDetails.length>0?a.menuDetails[0].id:null},n.value.menuGroupId&&(await B(n.value.menuGroupId),n.value.menuDetailId=a.menuDetails&&a.menuDetails.length>0?a.menuDetails[0].id:null);const e=document.getElementById("PermissionModal");e&&bootstrap.Modal.getOrCreateInstance(e).show()}const ie=async a=>{if(!a)return;if((await f.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#666CFF",cancelButtonColor:"#A7A9B3",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){y.setLoading(!0);try{const o=localStorage.getItem("token"),_=(await(await fetch(c.csrfToken(),{credentials:"include"})).json()).token,h=c.permissionDelete(a),C=await fetch(h,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},credentials:"include"});if(!C.ok){const p=await C.json();throw new Error(p.message||"Gagal menghapus permission")}await b(),await f.fire({title:"Berhasil!",text:"Permission berhasil dihapus.",icon:"success"})}catch(o){await f.fire({title:"Error",text:o.message,icon:"error"})}finally{y.setLoading(!1)}}},de=j(()=>!n.value.menuGroupId||!Array.isArray(P.value)?[]:P.value);U(()=>n.value.menuGroupId,(a,e)=>{a!==e&&(n.value.menuDetailId=null,B(a))});const ue=async()=>{await Promise.all([ne(),B()])};return(a,e)=>{const o=ye("Column");return i(),u("div",null,[t("div",Te,[t("div",Ge,[R.value?(i(),u("div",Ae,e[10]||(e[10]=[t("div",{class:"spinner-border",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):(i(),u(L,{key:1},[I.value.length>0?(i(),u("div",Me,[e[16]||(e[16]=t("h4",{class:"mb-1"},"List Permissions",-1)),e[17]||(e[17]=t("p",{class:"mb-6"}," List permissions yang terdaftar di sistem ",-1)),t("div",Ee,[v.value.total!==void 0?(i(),J(F,{key:0,title:"Total Permission",total:v.value.total+" Permission"},null,8,["total"])):be("",!0),(i(!0),u(L,null,q(v.value.roles,s=>(i(),J(F,{key:s.id,title:s.name.charAt(0).toUpperCase()+s.name.slice(1),total:s.total+" Permission"},null,8,["title","total"]))),128)),m(F,{isAddButtonCard:!0,"image-src":"/img/illustrations/add-new-role-illustration.png","image-alt":"Tambah Permission","button-text":"Tambah Permission","modal-target":"#PermissionModal",onButtonClick:le})]),t("div",Be,[e[15]||(e[15]=t("div",{class:"col-12"},[t("h4",{class:"mt-6 mb-1"},"Total Roles with their Permissions"),t("p",{class:"mb-0"},"Find all of your company's administrator accounts and their associate Permissions.")],-1)),t("div",je,[t("div",Le,[t("div",Fe,[t("div",$e,[e[11]||(e[11]=t("span",{class:"me-2"},"Baris:",-1)),m(D(he),{modelValue:l.value.rows,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.rows=s),options:H.value,optionLabel:"label",optionValue:"value",onChange:te,placeholder:"Jumlah",style:{width:"8rem"}},null,8,["modelValue","options"])]),t("div",Re,[t("div",Ve,[e[12]||(e[12]=t("button",{class:"btn btn-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"ri-upload-2-line me-1"}),x(" Export ")],-1)),t("ul",Ne,[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:e[1]||(e[1]=s=>z("csv"))},"CSV")]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:e[2]||(e[2]=s=>z("pdf"))},"PDF")])])]),t("div",Oe,[t("span",ze,[m(D(we),{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=s=>G.value=s),placeholder:"Cari permission...",class:"w-full md:w-20rem"},null,8,["modelValue"])])])])]),t("div",Ue,[m(xe,{ref_key:"myDataTableRef",ref:T,data:I.value,rows:l.value.rows,loading:R.value,totalRecords:A.value,lazy:!0,onPage:e[4]||(e[4]=s=>ae(s)),onSort:e[5]||(e[5]=s=>se(s)),responsiveLayout:"scroll",paginatorPosition:"bottom",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} data",filters:V.value,globalFilterFields:["name","menuGroups","menuDetails"]},{default:w(()=>[m(o,{field:"id",header:"#",sortable:!0,style:{width:"50px"}}),m(o,{field:"name",header:"Nama Permission",sortable:!0}),m(o,{field:"menuGroups",header:"Menu Group",sortable:!0},{body:w(s=>[Array.isArray(s.data.menuGroups)&&s.data.menuGroups.length>0?(i(),u("span",Je,S(s.data.menuGroups.map(d=>d.name).join(", ")),1)):(i(),u("span",qe,"-"))]),_:1}),m(o,{field:"menuDetails",header:"Menu Details",sortable:!0},{body:w(s=>[Array.isArray(s.data.menuDetails)&&s.data.menuDetails.length>0?(i(),u("span",Ke,S(s.data.menuDetails.map(d=>d.name).join(", ")),1)):(i(),u("span",Ye,"-"))]),_:1}),m(o,{field:"assignedRoles",header:"Assigned To"},{body:w(s=>[Array.isArray(s.data.assignedRoles)&&s.data.assignedRoles.length>0?(i(!0),u(L,{key:0},q(s.data.assignedRoles,d=>(i(),u("span",{key:d.id,class:ke(["badge","rounded-pill",oe(d.id),"mt-1"]),style:{"margin-right":"5px"}},S(d.name),3))),128)):(i(),u("span",He,"-"))]),_:1}),m(o,{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:w(s=>[t("button",{onClick:d=>re(s.data),class:"btn btn-sm btn-icon btn-text-secondary rounded-pill btn-icon me-2"},e[13]||(e[13]=[t("i",{class:"ri-edit-box-line"},null,-1)]),8,Qe),t("button",{onClick:d=>ie(s.data.id),class:"btn btn-sm btn-icon btn-text-secondary rounded-pill btn-icon"},e[14]||(e[14]=[t("i",{class:"ri-delete-bin-7-line"},null,-1)]),8,We)]),_:1})]),_:1},8,["data","rows","loading","totalRecords","filters"])])])])])])):(i(),u("div",Xe,[t("div",Ze,[e[19]||(e[19]=t("img",{src:De,alt:"page-misc-under-maintenance",width:"300",class:"img-fluid"},null,-1)),e[20]||(e[20]=t("h4",{class:"mt-4"},"Tidak ada data Permission",-1)),e[21]||(e[21]=t("p",{class:"mb-4"},[x(" Saat ini belum ada data permission yang tersedia."),t("br"),x(" Silakan buat permission baru untuk memulai. ")],-1)),t("button",{onClick:e[6]||(e[6]=s=>D($).openModal()),class:"btn btn-primary"},e[18]||(e[18]=[t("i",{class:"ri-add-line me-1"},null,-1),x(" Tambah Permission ")]))])])),m(Ie,{id:"PermissionModal",validationErrorsFromParent:M.value,title:Q.value,description:W.value},{default:w(()=>[t("form",{onSubmit:Pe(ee,["prevent"])},[t("div",ea,[t("div",aa,[e[22]||(e[22]=t("label",{for:"modalPermissionName"},"Permission Name",-1)),_e(t("input",{type:"text",id:"modalPermissionName","onUpdate:modelValue":e[7]||(e[7]=s=>n.value.name=s),class:"form-control",placeholder:"Enter a permission name",required:""},null,512),[[Ce,n.value.name]])]),t("div",ta,[e[23]||(e[23]=t("label",{for:"menuGroup"},"Menu Group",-1)),m(D(K),{modelValue:n.value.menuGroupId,"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.menuGroupId=s),options:N.value,label:"name",reduce:s=>s.id,placeholder:"-- Pilih Menu Group --",id:"menuGroup",class:"menu-group"},null,8,["modelValue","options","reduce"])]),t("div",sa,[e[24]||(e[24]=t("label",{for:"menuDetail"},"Menu Detail",-1)),m(D(K),{modelValue:n.value.menuDetailId,"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.menuDetailId=s),options:de.value,label:"name",reduce:s=>s.id,placeholder:"-- Pilih Menu Detail --",id:"menuDetail",class:"menu-detail"},null,8,["modelValue","options","reduce"])]),t("div",oa,[t("button",na,S(g.value?"Update":"Simpan"),1),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:O}," Batal ")])])],32)]),_:1},8,["validationErrorsFromParent","title","description"])],64))]),e[25]||(e[25]=t("div",{class:"content-backdrop fade"},null,-1))])])}}},ba=me(la,[["__scopeId","data-v-12ba48c3"]]);export{ba as default};
