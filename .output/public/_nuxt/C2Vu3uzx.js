import{e as c,f as n}from"./Bkm6qw8b.js";import{S as i}from"./9Qm2jZ7z.js";import{u}from"./Drh9hcrB.js";const f=c("menu-detail",{state:()=>({menuDetails:[],menuGroups:[],loading:!0,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchMenuDetails(){var e;this.loading=!0,this.error=null;const{$api:t}=n();try{const a=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"id",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),r=localStorage.getItem("token"),s=await fetch(`${t.menuDetails()}?${a.toString()}`,{headers:{Authorization:`Bearer ${r}`,Accept:"application/json"}});if(!s.ok)throw new Error("Gagal mengambil data menu detail");const o=await s.json();this.menuDetails=o.data||[],this.totalRecords=((e=o.meta)==null?void 0:e.total)||0}catch(a){this.error=a.message,i.fire("Error",`Tidak dapat memuat data menu detail: ${a.message}`,"error")}finally{this.loading=!1}},async fetchMenuGroupsForSelect(){const{$api:t}=n();try{const e=localStorage.getItem("token"),a=await fetch(t.menuGroups(),{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(!a.ok)throw new Error("Gagal mengambil data menu groups");const r=await a.json();this.menuGroups=r.data||[]}catch(e){console.error("Error fetching menu groups:",e),i.fire("Error","Gagal mengambil data Menu Group untuk pilihan.","error")}},async saveMenuDetail(){this.loading=!0,this.validationErrors=[];const{$api:t}=n();try{const e=localStorage.getItem("token");let a=t.menuDetails(),r="POST";const s=JSON.stringify(this.form);this.isEditMode&&this.form.id&&(a=`${t.menuDetails()}/${this.form.id}`,r="PUT");const o=await fetch(a,{method:r,headers:{Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"},body:s,credentials:"include"});if(!o.ok){const h=await o.json();throw o.status===422?(this.validationErrors=Object.values(h.errors).flat(),new Error("Data validasi tidak valid")):new Error(h.message||"Gagal menyimpan data menu detail")}this.closeModal(),await this.fetchMenuDetails(),await u().fetchAllMenuGroups(),i.fire("Berhasil!",`Menu detail berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(e){e.message!=="Data validasi tidak valid"&&i.fire("Error",e.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteMenuDetail(t){this.loading=!0;const{$api:e}=n();if(!(await i.fire({title:"Apakah Anda yakin?",text:"Data menu detail yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const r=localStorage.getItem("token"),s=await fetch(`${e.menuDetails()}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,Accept:"application/json"},credentials:"include"});if(!s.ok){const l=await s.json();throw new Error(l.message||"Gagal menghapus menu detail")}await this.fetchMenuDetails(),await u().fetchAllMenuGroups(),i.fire("Berhasil!","Menu detail berhasil dihapus.","success")}catch(r){console.error("Gagal menghapus menu detail:",r),i.fire("Error",r.message||"Gagal menghapus menu detail","error")}finally{this.loading=!1}},async openModal(t=null){this.isEditMode=!!t,this.validationErrors=[],t?this.form={...t}:this.form={name:"",route:"",order:void 0,status:1,menuGroupId:void 0},this.showModal=!0,await this.fetchMenuGroupsForSelect()},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(t){this.params.first=t.first,this.params.rows=t.rows,this.fetchMenuDetails()},setSort(t){this.params.sortField=t.sortField,this.params.sortOrder=t.sortOrder,this.fetchMenuDetails()},setSearch(t){this.params.search=t,this.params.first=0,this.fetchMenuDetails()}}});export{f as u};
