import{j as _,s as f,k as p,g as he,l as b,c as d,a as t,h as Y,A as y,B as h,n as P,i as l,b as w,F as X,x as Z,t as i,y as O,d as Ie,D as xe,o as c,L as Pe,I as we}from"./Bkm6qw8b.js";import{u as ke}from"./vvOl6aKk.js";import{u as Se}from"./BRMs87XN.js";import{u as _e}from"./DD8T_SWG.js";import{u as Oe}from"./Bmp6y9tu.js";import{u as Ce}from"./CGIrALZn.js";import{u as Ve}from"./WyHMcmGb.js";import{u as qe}from"./B1HDS-e3.js";import{u as De}from"./u26IMBn3.js";import{C}from"./D9zIpW-x.js";import{S as V}from"./9Qm2jZ7z.js";import{u as je}from"./D29843uf.js";import{u as ee}from"./CI-DMe-d.js";import"./BtuP6t-4.js";const Me={class:"navbar navbar-custom d-flex flex-wrap justify-content-between align-items-center"},Ue={class:"d-flex align-items-center gap-3 mt-3 mt-md-0"},Ne={class:"position-relative"},Ee={class:"container my-4 d-flex flex-lg-row flex-column px-20 gap-4"},Be={class:"flex-grow-1"},Te={class:"d-flex flex-column align-items-center w-100"},Fe={class:"article-row row g-4 justify-content-center",style:{width:"100%"}},$e={class:"card mt-5 mb-5 col-12",style:{"max-width":"1200px"}},Re={class:"card-body"},Le={class:"row"},Ae={class:"col-md-4"},Qe={class:"col-md-4"},ze={class:"col-md-4"},Ge={class:"row mt-5"},We={class:"col-md-4"},He={class:"col-md-4"},Je={class:"form-floating form-floating-outline"},Ke={class:"col-md-4"},Ye={class:"form-floating form-floating-outline"},Xe={class:"row flex-column justify-content-center align-items-center mt-10"},Ze={class:"product-slider-container"},et=["disabled"],tt={class:"article-row row g-4 g-lg-3 px-5"},st=["onClick"],at={class:"img-wrapper"},ot=["src"],lt={class:"kategori"},nt={class:"price"},rt={class:"stock"},it={key:0,class:"selected-indicator"},ut=["disabled"],dt={key:0,class:"col-12 text-center mt-5"},ct={key:0,class:"d-flex justify-content-center mt-4"},mt={class:"order-card"},pt={class:"order-list mt-5 mb-5"},vt={class:"item-info"},ft=["src","alt"],gt={class:"item-details"},bt={class:"item-name"},yt={class:"item-price"},ht={class:"quantity-controls d-flex justify-content-center align-items-center"},It=["onClick"],xt=["onClick"],Pt={key:0,class:"text-center w-100"},wt={class:"order-summary mt-5 mb-5"},kt={class:"total"},St={class:"payment-methods"},_t={class:"d-flex 2 justify-content-center gap-2"},Ot=["disabled"],Ct={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Yt={__name:"index",setup(Vt){const q=we();xe(),_(null);const r=ke(),U=Se(),N=_e(),E=Ve(),B=Oe(),m=Ce();qe();const T=De(),g=je(),{salesOrders:qt,loading:D,totalRecords:Dt,params:jt,form:a,isEditMode:te,showModal:Mt,validationErrors:Ut,customerProducts:Nt}=f(r),{customers:se}=f(U),{perusahaans:F}=f(N),{cabangs:$}=f(B),{warehouses:ae}=f(E),{products:I,loading:R,totalRecords:L,params:u}=f(m),{user:Et}=f(T),k=_(""),A=_("");_(null);const oe=o=>!o||typeof o!="string"?null:o.startsWith("http")||!q.public.apiBase?o:`${new URL(q.public.apiBase).origin}/${o}`,Q=o=>a.value.salesOrderItems&&a.value.salesOrderItems.some(e=>e.productId===o),le=o=>{var s,n;a.value.salesOrderItems||(a.value.salesOrderItems=[]);const e=a.value.salesOrderItems.findIndex(v=>v.productId===o.id);e>-1?r.removeItem(e):(((n=(s=o.stocks)==null?void 0:s[0])==null?void 0:n.quantity)??0)>0?a.value.salesOrderItems.push({productId:o.id,quantity:1,price:o.priceSell||0,description:"",subtotal:o.priceSell||0}):V.fire({title:"Produk ini kehabisan stok.",icon:"warning"})},ne=o=>{const e=a.value.salesOrderItems[o],s=I.value.find(n=>n.id===e.productId);if(s&&s.stocks&&s.stocks.length>0){const n=s.stocks[0].quantity;e.quantity<n?e.quantity++:alert("Jumlah melebihi stok yang tersedia.")}else e.quantity++;J(o)},re=o=>{const e=a.value.salesOrderItems[o];e.quantity--,e.quantity<=0?r.removeItem(o):J(o)},j=p(()=>a.value.salesOrderItems?a.value.salesOrderItems.map(o=>{const e=I.value.find(s=>s.id===o.productId);return{...o,product:e}}).filter(o=>o.product):[]),S=p(()=>j.value.reduce((o,e)=>o+e.quantity*e.price,0)),M=p(()=>{const o=Number(a.value.discountPercent)||0;return S.value*(o/100)}),z=p(()=>{const o=Number(a.value.taxPercent)||0;return(S.value-M.value)*(o/100)}),ie=p(()=>S.value-M.value+z.value),G=()=>{a.value.salesOrderItems=[]},ue=async()=>{if(!a.value.perusahaanId||!a.value.cabangId||!a.value.warehouseId||!a.value.customerId){V.fire("Error","Harap lengkapi pilihan Perusahaan, Cabang, Gudang, dan Pelanggan.","error");return}if(!a.value.salesOrderItems||a.value.salesOrderItems.length===0){V.fire("Error","Tidak ada item dalam pesanan.","error");return}if(!a.value.paymentMethod){V.fire("Error","Harap pilih metode pembayaran.","error");return}const o=a.value.warehouseId;a.value.salesOrderItems.forEach(e=>{e.warehouseId=o}),await r.saveSalesOrder(),r.validationErrors.length===0&&(G(),a.value.perusahaanId=null,a.value.cabangId=null,a.value.warehouseId=null,a.value.customerId=null,a.value.paymentMethod="")};p(()=>{if(!a.value||!a.value.salesOrderItems)return 0;const o=a.value.salesOrderItems.reduce((ge,K)=>{const be=Number(K.quantity)||0,ye=Number(K.price)||0;return ge+be*ye},0),e=Number(a.value.discountPercent)||0,s=Number(a.value.taxPercent)||0,n=o*(e/100),v=o-n,x=v*(s/100);return v+x}),he(()=>{r.resetForm("pos");const o=new Date().toISOString().split("T")[0];a.value.date=o,a.value.dueDate=o,r.fetchSalesOrders(),U.fetchCustomers(),N.fetchPerusahaans(),B.fetchCabangs(),m.params.rows=9,m.fetchProducts(),E.fetchWarehouses(),T.loadUser();const e=document.getElementById("SalesOrderModal");e&&new bootstrap.Modal(e)}),b(()=>a.value.perusahaanId,o=>{if(o){const e=F.value.find(s=>s.id===o);e&&(a.value.up=e.nmPerusahaan),te.value||(a.value.cabangId=null)}else a.value.up=""}),b(()=>a.value.customerId,(o,e)=>{o&&e&&o!==e?(r.fetchProductsForCustomer(o),a.value.salesOrderItems=[],r.addItem()):o&&!e?r.fetchProductsForCustomer(o):o||(r.customerProducts=[],a.value.salesOrderItems=[],r.addItem())}),b(()=>r.customerProducts,o=>{a.value.salesOrderItems&&o&&a.value.salesOrderItems.forEach(e=>{o.some(n=>n.id===e.productId)||(e.productId=null,e.price=0,e.quantity=1,e.subtotal=0)})},{deep:!0}),b(()=>a.value.warehouseId,o=>{o?m.setWarehouseFilter(o):m.setWarehouseFilter(null)});const de=p(()=>!a.value.perusahaanId||!$.value?[]:$.value.filter(o=>o.perusahaanId===a.value.perusahaanId)),ce=ee(()=>{m.setSearch(k.value)},500);b(k,ce);const me=ee(()=>{r.setSearch(A.value)},500);b(A,me);const pe=o=>{u.value.first=o.first,u.value.rows=o.rows,m.fetchProducts()},W=p(()=>u.value.first===0),H=p(()=>{const o=L.value,{first:e,rows:s}=u.value;return e+s>=o}),ve=()=>{H.value||(u.value.first+=u.value.rows,m.fetchProducts())},fe=()=>{W.value||(u.value.first-=u.value.rows,m.fetchProducts())},J=o=>{const e=a.value.salesOrderItems[o],s=Number(e.quantity)||0,n=Number(e.price)||0;e.subtotal=s*n};return(o,e)=>(c(),d("div",null,[t("nav",Me,[e[17]||(e[17]=t("a",{class:"navbar-brand text-white fw-semibold fs-5 mb-0"},"Kainnova Digital Solutions",-1)),t("form",Ue,[t("div",Ne,[y(t("input",{class:"form-control",type:"search",placeholder:"Find Products","aria-label":"Search","onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s)},null,512),[[h,k.value]]),e[15]||(e[15]=t("i",{class:"fas fa-search position-absolute",style:{left:"12px",top:"50%",transform:"translateY(-50%)","font-size":"0.75rem",color:"white"}},null,-1))]),e[16]||(e[16]=Y('<button type="button" class="icon-btn" aria-label="Notifications"><i class="fas fa-bell"></i><span class="notification-dot"></span></button><button type="button" class="icon-btn" aria-label="User Profile"><i class="fas fa-user"></i></button><button type="button" class="icon-btn" aria-label="Toggle Theme"><i class="fas fa-sun"></i></button><button type="button" class="btn btn-primary px-3 py-2 fw-semibold"> New Goal </button>',4))])]),t("main",Ee,[t("section",Be,[t("div",Te,[e[24]||(e[24]=Y('<nav class="category-nav d-flex mb-4 flex-wrap justify-content-center" style="width:100%;"><button class="category-btn active" type="button"><img src="https://storage.googleapis.com/a1aa/image/bf1b63b5-ca10-495f-45e5-30feb47fa60b.jpg" alt="Plate of spaghetti with fork icon"><div>Lunch</div><div class="category-subtext">8 Options</div></button><button class="category-btn" type="button"><img src="https://storage.googleapis.com/a1aa/image/967eaac6-3bc2-49d9-30da-55bbaced9692.jpg" alt="Bowl of salad icon"><div>Salad</div><div class="category-subtext">14 Salads</div></button><button class="category-btn" type="button"><img src="https://storage.googleapis.com/a1aa/image/67a2564b-e29a-4fd9-0dab-08bfa4f8ee37.jpg" alt="Burger icon"><div>Burger</div><div class="category-subtext">5 Burgers</div></button><button class="category-btn" type="button"><img src="https://storage.googleapis.com/a1aa/image/04505586-79e5-4b7f-d082-e1af7819676d.jpg" alt="Coffee cup icon"><div>Coffee</div><div class="category-subtext">7 Beverages</div></button><button class="category-btn" type="button"><img src="https://storage.googleapis.com/a1aa/image/54949dd3-ee31-455a-8c18-c1842dd646f8.jpg" alt="Slice of cake icon"><div>Dessert</div><div class="category-subtext">8 Desserts</div></button><button class="category-btn" type="button"><img src="https://storage.googleapis.com/a1aa/image/54949dd3-ee31-455a-8c18-c1842dd646f8.jpg" alt="Slice of cake icon"><div>Dessert</div><div class="category-subtext">8 Desserts</div></button></nav>',1)),t("div",Fe,[t("div",$e,[e[23]||(e[23]=t("div",{class:"card-header"},[t("h2",{class:"fw-bold",style:{"font-size":"1.1rem"}},"Pilih Perusahaan, Cabang, Gudang, dan Pelanggan")],-1)),t("div",Re,[t("div",Le,[y(t("input",{type:"hidden","onUpdate:modelValue":e[1]||(e[1]=s=>l(a).up=s),class:"form-control"},null,512),[[h,l(a).up]]),y(t("input",{type:"hidden","onUpdate:modelValue":e[2]||(e[2]=s=>l(a).date=s),class:"form-control"},null,512),[[h,l(a).date]]),y(t("input",{type:"hidden","onUpdate:modelValue":e[3]||(e[3]=s=>l(a).dueDate=s),class:"form-control"},null,512),[[h,l(a).dueDate]]),t("div",Ae,[w(l(C),{modelValue:l(a).perusahaanId,"onUpdate:modelValue":e[4]||(e[4]=s=>l(a).perusahaanId=s),options:l(F),label:"nmPerusahaan",reduce:s=>s.id,placeholder:"Pilih Perusahaan",class:"v-select-style"},null,8,["modelValue","options","reduce"])]),t("div",Qe,[w(l(C),{modelValue:l(a).cabangId,"onUpdate:modelValue":e[5]||(e[5]=s=>l(a).cabangId=s),options:de.value,label:"nmCabang",reduce:s=>s.id,placeholder:"Pilih Cabang",class:"v-select-style"},null,8,["modelValue","options","reduce"])]),t("div",ze,[w(l(C),{modelValue:l(a).warehouseId,"onUpdate:modelValue":e[6]||(e[6]=s=>l(a).warehouseId=s),options:l(ae),"get-option-label":s=>`${s.name} (${s.code})`,reduce:s=>s.id,placeholder:"Pilih Gudang",class:"v-select-style"},null,8,["modelValue","options","get-option-label","reduce"])])]),t("div",Ge,[t("div",We,[w(l(C),{modelValue:l(a).customerId,"onUpdate:modelValue":e[7]||(e[7]=s=>l(a).customerId=s),options:l(se),label:"name",reduce:s=>s.id,placeholder:"Pilih Pelanggan",class:"v-select-style"},null,8,["modelValue","options","reduce"])]),t("div",He,[t("div",Je,[y(t("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=s=>l(a).discountPercent=s),class:"form-control",placeholder:"Discount (%)"},null,512),[[h,l(a).discountPercent]]),e[18]||(e[18]=t("label",null,"Discount(%)",-1))])]),t("div",Ke,[t("div",Ye,[y(t("input",{type:"number","onUpdate:modelValue":e[9]||(e[9]=s=>l(a).taxPercent=s),class:"form-control",placeholder:"Tax (%)"},null,512),[[h,l(a).taxPercent]]),e[19]||(e[19]=t("label",null,"Tax(%)",-1))])])]),t("div",Xe,[e[22]||(e[22]=t("h2",{class:"fw-bold",style:{"font-size":"1.1rem"}},"Daftar Produk",-1)),t("div",Ze,[t("button",{onClick:fe,disabled:W.value,class:"slider-arrow prev-arrow"},"‹",8,et),t("div",tt,[(c(!0),d(X,null,Z(l(I),s=>(c(),d("article",{class:"product-card col-6 col-sm-4 col-lg-3 col-md-3 mb-5",key:s.id},[t("div",{class:O(["card-custom",{selected:Q(s.id)}]),onClick:n=>le(s),style:{"margin-bottom":"0"}},[t("div",at,[t("img",{src:oe(s.image)||"/img/branding/logo.png",alt:"Product Image",style:{height:"120px","max-width":"120px","object-fit":"contain"},onError:e[10]||(e[10]=n=>n.target.src="/img/branding/logo.png")},null,40,ot)]),t("h6",null,i(s.name),1),t("p",lt,i(s.category.name),1),t("p",nt,i(l(g)(s.priceSell)),1),t("p",rt,"Stock: "+i(s.stocks&&s.stocks.length>0?Math.floor(s.stocks[0].quantity):0),1),Q(s.id)?(c(),d("div",it,e[20]||(e[20]=[t("i",{class:"fas fa-check-circle"},null,-1)]))):P("",!0)],10,st)]))),128))]),t("button",{onClick:ve,disabled:H.value,class:"slider-arrow next-arrow"},"›",8,ut)]),!l(R)&&!l(I).length?(c(),d("div",dt,e[21]||(e[21]=[t("p",null,"Tidak ada produk yang tersedia di gudang ini.",-1)]))):P("",!0)])])])]),!l(R)&&l(I).length>0?(c(),d("div",ct,[w(l(Pe),{rows:l(u).rows,totalRecords:l(L),rowsPerPageOptions:[9,18,27],onPage:pe,first:l(u).first},null,8,["rows","totalRecords","first"])])):P("",!0)])]),t("aside",null,[t("div",mt,[t("div",{class:"order-header d-flex justify-content-between align-items-center"},[e[25]||(e[25]=t("h2",null,"Current Order",-1)),t("button",{class:"btn-clear",onClick:G},"Clear All")]),t("ul",pt,[(c(!0),d(X,null,Z(j.value,(s,n)=>{var v;return c(),d("li",{class:"d-flex justify-content-between align-items-center mb-3 mt-3",key:s.productId},[t("div",vt,[t("img",{src:s.product&&s.product.image?`${l(q).public.baseURL}/${s.product.image}`:"/img/branding/logo.png",alt:s.product&&s.product.name?s.product.name:"Logo",onError:e[11]||(e[11]=x=>x.target.src="/img/branding/logo.png"),class:"img-fluid"},null,40,ft),t("div",gt,[t("span",bt,i((v=s.product)==null?void 0:v.name),1),e[26]||(e[26]=t("br",null,null,-1)),t("span",yt,i(l(g)(s.quantity*s.price)),1)])]),t("div",ht,[t("button",{onClick:x=>re(n),"aria-label":"Decrease quantity"},"−",8,It),t("span",null,i(s.quantity),1),t("button",{onClick:x=>ne(n),"aria-label":"Increase quantity"},"+",8,xt)])])}),128)),j.value.length===0?(c(),d("li",Pt,e[27]||(e[27]=[t("p",null,"No items in order.",-1)]))):P("",!0)]),t("div",wt,[t("div",null,[e[28]||(e[28]=t("span",null,"Subtotal",-1)),t("span",null,i(l(g)(S.value)),1)]),t("div",null,[e[29]||(e[29]=t("span",null,"Discounts",-1)),t("span",null,"-"+i(l(g)(M.value)),1)]),t("div",null,[t("span",null,"Tax("+i(l(a).taxPercent||0)+"%)",1),t("span",null,i(l(g)(z.value)),1)]),t("div",kt,[e[30]||(e[30]=t("span",null,"Total",-1)),t("span",null,i(l(g)(ie.value)),1)])]),t("div",St,[e[34]||(e[34]=t("h5",null,"Payment Method",-1)),t("div",_t,[t("button",{class:O(["payment-btn",{active:l(a).paymentMethod==="cash"}]),onClick:e[12]||(e[12]=s=>l(a).paymentMethod="cash")},e[31]||(e[31]=[t("i",{class:"ri-cash-line"},null,-1),t("span",null,"Cash",-1)]),2),t("button",{class:O(["payment-btn",{active:l(a).paymentMethod==="card"}]),onClick:e[13]||(e[13]=s=>l(a).paymentMethod="card")},e[32]||(e[32]=[t("i",{class:"ri-bank-card-line"},null,-1),t("span",null,"Card",-1)]),2),t("button",{class:O(["payment-btn",{active:l(a).paymentMethod==="transfer"}]),onClick:e[14]||(e[14]=s=>l(a).paymentMethod="transfer")},e[33]||(e[33]=[t("i",{class:"ri-exchange-dollar-line"},null,-1),t("span",null,"Transfer",-1)]),2)])]),t("button",{class:"btn-print",type:"button",onClick:ue,disabled:l(D)},[l(D)?(c(),d("span",Ct)):P("",!0),Ie(" "+i(l(D)?"Menyimpan...":"Simpan"),1)],8,Ot)])])])]))}};export{Yt as default};
