import{_ as te,f as ae,j as g,s as $,k as y,l as A,K as oe,g as se,c as w,a as t,b as i,m as C,n as m,i as o,d as p,w as f,D as re,r as ne,o as c,q as ie,v as le,t as S,y as de,z as ce,A as N,B as j}from"./Bkm6qw8b.js";import{u as ue}from"./u26IMBn3.js";import{u as me}from"./DS26QXx3.js";import{u as pe}from"./WyHMcmGb.js";import{_ as fe}from"./BAMzpvu1.js";import{_ as T}from"./CdgIhitS.js";import{_ as ve}from"./DleeVanq.js";import{S as l}from"./9Qm2jZ7z.js";import{C as L}from"./D9zIpW-x.js";import"./D1pefl20.js";const be={class:"content-wrapper"},ge={class:"container-xxl flex-grow-1 container-p-y"},ke={class:"row g-6 mb-6"},he={class:"row g-6"},we={class:"col-12"},Se={class:"card"},ye={class:"card-header d-flex justify-content-between align-items-center flex-wrap"},_e={class:"d-flex align-items-center me-3 mb-2 mb-md-0"},Ie={class:"d-flex align-items-center"},xe={class:"btn-group me-2"},Ce={class:"dropdown-menu"},Te={class:"input-group"},Ve={class:"p-input-icon-left"},Be={class:"card-datatable table-responsive py-3 px-3"},De={class:"badge bg-primary"},Ee={class:"d-inline-block"},Pe={class:"dropdown-menu"},Me={key:0},$e=["onClick"],Ae={key:1},Ne=["onClick"],je={key:2},Le=["onClick"],Re={key:3},Fe=["onClick"],Ue={class:"row g-6"},Ge={class:"col-md-6"},Oe={class:"form-floating form-floating-outline"},qe={class:"col-md-6"},ze={class:"form-floating form-floating-outline"},Je={class:"col-md-6"},We={class:"form-floating form-floating-outline"},He={class:"col-md-6"},Ke={class:"form-floating form-floating-outline"},Ye={class:"d-flex justify-content-end"},Qe={__name:"stock-in",setup(Xe){const{$api:Ze}=ae(),_=g(null),V=ue(),n=me(),B=pe(),{stockIns:R,totalRecords:F,stats:v,params:u,form:d,isEditMode:b,showModal:U,validationErrors:G}=$(n),{warehouse:O}=$(B),q=g(null),z=g(!1),I=g(""),J=re(),k=y(()=>{var s,e;return((e=(s=V.user)==null?void 0:s.roles)==null?void 0:e.some(r=>r.name==="superadmin"))??!1}),W=y(()=>{var s,e;return((e=(s=V.user)==null?void 0:s.roles)==null?void 0:e.some(r=>r.name==="admin"))??!1}),H=g([{label:"Draft",value:"draft"},{label:"Posted",value:"posted"}]),K=g([10,25,50,100]),Y=y(()=>b.value?"Edit Stock In":"Tambah Stock In"),Q=y(()=>b.value?"Silakan ubah data stock in di bawah ini.":"Silakan isi form di bawah ini untuk menambahkan stock in baru.");A(U,s=>{const e=document.getElementById("Modal");if(e&&window.bootstrap){const r=bootstrap.Modal.getInstance(e)||new bootstrap.Modal(e);s?r.show():r.hide()}});let h=null;A(I,s=>{h&&clearTimeout(h),h=setTimeout(()=>{n.setSearch(s)},500)}),oe(()=>{h&&clearTimeout(h)});const D=async()=>{if(!d.value.noSi)return l.fire("Validasi","No SI wajib diisi.","warning");try{await n.saveStockIn(),await n.fetchStockInsPaginated(),n.closeModal(),l.fire("Berhasil!",`Stock In berhasil ${b.value?"diperbarui":"dibuat"}.`,"success")}catch(s){const e=s;e.errors?(n.validationErrors=Array.isArray(e.errors)?e.errors:Object.values(e.errors).flat(),l.fire("Gagal","Terdapat kesalahan validasi data.","error")):l.fire("Gagal",e.message||`Gagal ${b.value?"memperbarui":"membuat"} stock in`,"error")}},X=async s=>{try{await n.postStockIn(s),await n.fetchStockInsPaginated(),await l.fire("Berhasil!","Stock In berhasil diposting.","success")}catch(e){let r="Gagal memposting stock in";e instanceof Error?r=e.message:typeof e=="string"&&(r=e);try{const a=JSON.parse(r);if(a.errors)return n.validationErrors=Array.isArray(a.errors)?a.errors:Object.values(a.errors).flat(),l.fire("Gagal","Terdapat kesalahan validasi data.","error");r=a.message||r}catch{}await l.fire("Error",r,"error")}},E=async()=>{try{await n.fetchStockInsPaginated()}catch(s){const e=s.message;l.fire("Error",`Tidak dapat memuat data stock in: ${e}`,"error")}};se(()=>{E(),n.fetchStats(),B.fetchWarehouses()});const P=s=>{s==="csv"?_.value.exportCSV():s==="pdf"&&_.value.exportPDF()},Z=s=>{J.push({path:"/inventory/stock-in-detail",query:{id:s}})},ee=async s=>{if(!s)return;if((await l.fire({title:"Apakah Anda yakin?",text:"Tindakan ini tidak bisa dibatalkan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#666CFF",cancelButtonColor:"#A7A9B3",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{await n.deleteStockIn(s),E(),await l.fire({title:"Berhasil!",text:"Stock In berhasil dihapus.",icon:"success"})}catch(r){await l.fire({title:"Error",text:r.message,icon:"error"})}},M=s=>{switch(s){case"draft":return{text:"Draft",class:"badge rounded-pill bg-label-secondary"};case"posted":return{text:"Posted",class:"badge rounded-pill bg-label-success"}}};return(s,e)=>{const r=ne("Column");return c(),w("div",be,[t("div",ge,[e[21]||(e[21]=t("h4",{class:"mb-1"},"List Stock In",-1)),e[22]||(e[22]=t("p",{class:"mb-6"}," List stock in yang terdaftar di sistem ",-1)),t("div",ke,[o(v).total!==void 0?(c(),C(T,{key:0,title:"Total Stock In",total:o(v).total+" Stock In"},null,8,["total"])):m("",!0),o(v).draft!==void 0?(c(),C(T,{key:1,title:"Total Stock In Draft",total:o(v).draft+" Stock In"},null,8,["total"])):m("",!0),o(v).posted!==void 0?(c(),C(T,{key:2,title:"Total Stock In Posted",total:o(v).posted+" Stock In"},null,8,["total"])):m("",!0)]),t("div",he,[e[18]||(e[18]=t("div",{class:"col-12"},[t("h4",{class:"mt-6 mb-1"},"Total Stock In"),t("p",{class:"mb-0"},"Find all of your company's administrator accounts and their associate Stock In.")],-1)),t("div",we,[t("div",Se,[t("div",ye,[t("div",_e,[e[11]||(e[11]=t("span",{class:"me-2"},"Baris:",-1)),i(o(ie),{modelValue:o(u).rows,"onUpdate:modelValue":e[0]||(e[0]=a=>o(u).rows=a),options:K.value,onChange:o(n).handleRowsChange,placeholder:"Jumlah",style:{width:"8rem"}},null,8,["modelValue","options","onChange"])]),t("div",Ie,[t("div",xe,[e[12]||(e[12]=t("button",{class:"btn btn-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"ri-upload-2-line me-1"}),p(" Export ")],-1)),t("ul",Ce,[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:e[1]||(e[1]=a=>P("csv"))},"CSV")]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:e[2]||(e[2]=a=>P("pdf"))},"PDF")])])]),t("div",Te,[t("span",Ve,[i(o(le),{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=a=>I.value=a),placeholder:"Cari Stock In...",class:"w-full md:w-20rem"},null,8,["modelValue"])])])])]),t("div",Be,[i(ve,{ref_key:"myDataTableRef",ref:_,data:o(R),rows:o(u).rows,loading:z.value,totalRecords:o(F),lazy:!0,onPage:e[4]||(e[4]=a=>o(n).setPagination(a)),onSort:e[5]||(e[5]=a=>o(n).setSort(a)),responsiveLayout:"scroll",paginatorPosition:"bottom",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} data"},{default:f(()=>[i(r,{header:"#",sortable:!1},{body:f(a=>[p(S(Number.isFinite(o(u).page)&&Number.isFinite(o(u).rows)?(o(u).page-1)*o(u).rows+a.index+1:a.index+1),1)]),_:1}),i(r,{field:"noSi",header:"No. Stock In",sortable:!0},{body:f(a=>[t("span",De,S(a.data.noSi),1)]),_:1}),i(r,{field:"date",header:"Tanggal",sortable:!0,style:{width:"10%"}},{body:f(a=>[p(S(a.data.date?new Date(a.data.date).toLocaleDateString():"-"),1)]),_:1}),i(r,{field:"purchaseOrder.noPo",header:"No. PO",sortable:!0,class:"text-nowrap"}),i(r,{field:"status",header:"Status",sortable:!0},{body:f(a=>[t("span",{class:de(M(a.data.status).class)},S(M(a.data.status).text),3)]),_:1}),i(r,{field:"warehouse.name",header:"Gudang",sortable:!0}),i(r,{field:"purchaseOrder.receivedByUser.fullName",header:"Penerima",sortable:!0}),i(r,{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:f(a=>[t("div",Ee,[e[17]||(e[17]=t("a",{href:"javascript:;",class:"btn btn-sm btn-text-secondary rounded-pill btn-icon dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[t("i",{class:"ri-more-2-fill"})],-1)),t("ul",Pe,[W.value||k.value&&a.data.status=="draft"?(c(),w("li",Me,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:x=>X(a.data.id)},e[13]||(e[13]=[t("i",{class:"ri-upload-2-line me-2"},null,-1),p(" Post ")]),8,$e)])):m("",!0),a.data.status=="posted"?(c(),w("li",Ae,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:x=>Z(a.data.id)},e[14]||(e[14]=[t("i",{class:"ri-eye-line me-2"},null,-1),p(" Lihat Detail ")]),8,Ne)])):m("",!0),k.value||!k.value&&a.data.status=="draft"?(c(),w("li",je,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:x=>o(n).openModal(a.data)},e[15]||(e[15]=[t("i",{class:"ri-edit-box-line me-2"},null,-1),p(" Edit ")]),8,Le)])):m("",!0),k.value||!k.value&&a.data.status=="Received"?(c(),w("li",Re,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:x=>ee(a.data.id)},e[16]||(e[16]=[t("i",{class:"ri-delete-bin-7-line me-2"},null,-1),p(" Hapus ")]),8,Fe)])):m("",!0)])])]),_:1})]),_:1},8,["data","rows","loading","totalRecords"])])])])]),i(fe,{isEditMode:o(b),validationErrorsFromParent:o(G),title:Y.value,description:Q.value,selectedStockIn:q.value},{default:f(()=>[t("form",{onSubmit:ce(D,["prevent"])},[t("div",Ue,[t("div",Ge,[t("div",Oe,[N(t("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":e[6]||(e[6]=a=>o(d).noSi=a),placeholder:"Masukkan no SI",required:""},null,512),[[j,o(d).noSi]]),e[19]||(e[19]=t("label",{for:"name"},"No SI",-1))])]),t("div",qe,[t("div",ze,[N(t("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[7]||(e[7]=a=>o(d).date=a),placeholder:"Masukkan tanggal",required:""},null,512),[[j,o(d).date]]),e[20]||(e[20]=t("label",{for:"name"},"Tanggal",-1))])]),t("div",Je,[t("div",We,[i(o(L),{modelValue:o(d).warehouseId,"onUpdate:modelValue":e[8]||(e[8]=a=>o(d).warehouseId=a),options:o(O),label:"name",reduce:a=>a.id,placeholder:"-- Pilih Gudang --",class:"warehouse-select"},null,8,["modelValue","options","reduce"])])]),t("div",He,[t("div",Ke,[i(o(L),{modelValue:o(d).status,"onUpdate:modelValue":e[9]||(e[9]=a=>o(d).status=a),options:H.value,label:"label",reduce:a=>a.value,placeholder:"-- Pilih Status --",class:"status-select"},null,8,["modelValue","options","reduce"])])]),t("div",Ye,[t("button",{type:"submit",class:"btn btn-primary me-2",onClick:D},S(o(b)?"Update":"Simpan"),1),t("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=a=>o(n).closeModal())}," Batal ")])])],32)]),_:1},8,["isEditMode","validationErrorsFromParent","title","description","selectedStockIn"])]),e[23]||(e[23]=t("div",{class:"content-backdrop fade"},null,-1))])}}},ct=te(Qe,[["__scopeId","data-v-083c4512"]]);export{ct as default};
