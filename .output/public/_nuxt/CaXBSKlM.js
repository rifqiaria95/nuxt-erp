import{e as d,f as n}from"./Bkm6qw8b.js";import{S as o}from"./9Qm2jZ7z.js";const m=d("departemen",{state:()=>({departemens:[],divisis:[],loading:!1,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"id",sortOrder:1,search:""},form:{},isEditMode:!1,showModal:!1,validationErrors:[]}),actions:{async fetchDepartemens(){var a;this.loading=!0,this.error=null;const{$api:e}=n();try{const r=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"id",sortOrder:(this.params.sortOrder||1)>0?"asc":"desc",search:this.params.search||""}),t=localStorage.getItem("token"),s=await fetch(`${e.departemen()}?${r.toString()}`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(!s.ok)throw new Error("Gagal mengambil data departemen");const i=await s.json();this.departemens=i.data||[],this.totalRecords=((a=i.meta)==null?void 0:a.total)||0}catch(r){this.error=r.message,o.fire("Error",`Tidak dapat memuat data departemen: ${r.message}`,"error")}finally{this.loading=!1}},async fetchDivisisForSelect(){const{$api:e}=n();try{const a=localStorage.getItem("token"),r=await fetch(e.divisi(),{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(!r.ok)throw new Error("Gagal mengambil data divisi");const t=await r.json();this.divisis=t.data||[]}catch(a){console.error("Error fetching divisis:",a),o.fire("Error","Gagal mengambil data Divisi untuk pilihan.","error")}},async saveDepartemen(){this.loading=!0,this.validationErrors=[];const{$api:e}=n();try{const a=localStorage.getItem("token");let r=e.departemen(),t="POST";const s=JSON.stringify({nm_departemen:this.form.nmDepartemen,divisi_id:this.form.divisiId});this.isEditMode&&this.form.id&&(r=`${e.departemen()}/${this.form.id}`,t="PUT");const i=await fetch(r,{method:t,headers:{Authorization:`Bearer ${a}`,Accept:"application/json","Content-Type":"application/json"},body:s,credentials:"include"});if(!i.ok){const l=await i.json();throw i.status===422?(this.validationErrors=Object.values(l.errors).flat(),new Error("Data validasi tidak valid")):new Error(l.message||"Gagal menyimpan data departemen")}this.closeModal(),await this.fetchDepartemens(),o.fire("Berhasil!",`Departemen berhasil ${this.isEditMode?"diperbarui":"disimpan"}.`,"success")}catch(a){a.message!=="Data validasi tidak valid"&&o.fire("Error",a.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteDepartemen(e){this.loading=!0;const{$api:a}=n();if(!(await o.fire({title:"Apakah Anda yakin?",text:"Data departemen yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const t=localStorage.getItem("token"),s=await fetch(`${a.departemen()}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,Accept:"application/json"},credentials:"include"});if(!s.ok){const i=await s.json();throw new Error(i.message||"Gagal menghapus departemen")}await this.fetchDepartemens(),o.fire("Berhasil!","Departemen berhasil dihapus.","success")}catch(t){console.error("Gagal menghapus departemen:",t),o.fire("Error",t.message||"Gagal menghapus departemen","error")}finally{this.loading=!1}},async openModal(e=null){await this.fetchDivisisForSelect(),this.isEditMode=!!e,this.validationErrors=[],e?this.form={...e}:this.form={nmDepartemen:"",divisiId:void 0},this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.form={},this.validationErrors=[]},setPagination(e){this.params.first=e.first,this.params.rows=e.rows,this.fetchDepartemens()},setSort(e){this.params.sortField=e.sortField,this.params.sortOrder=e.sortOrder,this.fetchDepartemens()},setSearch(e){this.params.search=e,this.params.first=0,this.fetchDepartemens()},async fetchDepartemensByDivisi(e){if(!e){this.departemens=[];return}this.loading=!0;const{$api:a}=n(),r=localStorage.getItem("token");try{const t=await fetch(a.departemen()+`?divisi_id=${e}`,{method:"GET",headers:{Authorization:`Bearer ${r}`,Accept:"application/json"}});if(!t.ok)throw new Error("Gagal mengambil data departemen by divisi");const s=await t.json();this.departemens=s.data||[]}catch(t){console.error("Gagal mengambil data departemen by divisi:",t)}finally{this.loading=!1}}}});export{m as u};
