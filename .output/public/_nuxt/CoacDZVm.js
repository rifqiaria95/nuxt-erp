import{e as ke,f as U,_ as ye,j as G,s as j,k as X,g as we,l as B,c as y,a as e,b as f,h as Re,i as s,d as V,w as _,D as Ie,o as w,q as _e,v as Ee,E as R,t as $,y as Ce,n as L,z as re,A as M,B as N,F as Oe,x as Te,I as De}from"./Bkm6qw8b.js";import{_ as xe}from"./mvyRji1Y.js";import{a as je}from"./BtuP6t-4.js";import{S}from"./9Qm2jZ7z.js";import{u as oe}from"./u26IMBn3.js";import{u as le}from"./B1HDS-e3.js";import{u as K}from"./CGIrALZn.js";import{u as Ve}from"./BRMs87XN.js";import{u as $e}from"./DD8T_SWG.js";import{u as Pe}from"./Bmp6y9tu.js";import{u as Ae}from"./WyHMcmGb.js";import{u as Fe}from"./VXGyPOT6.js";import{u as Ue}from"./Ca1Fz0tn.js";import{_ as Be}from"./BAMzpvu1.js";import{_ as Me}from"./DleeVanq.js";import{C}from"./D9zIpW-x.js";import{u as Ne}from"./D29843uf.js";import{u as qe}from"./CI-DMe-d.js";const Ge=ke("salesReturn",{state:()=>({salesReturns:[],salesReturn:null,originalSalesReturn:null,salesOrders:[],loading:!0,error:null,totalRecords:0,params:{first:0,rows:10,sortField:"createdAt",sortOrder:-1,draw:1,search:"",customerId:null,perusahaanId:null,status:null},form:{noSo:"",noSr:"",up:"",customerId:null,perusahaanId:null,cabangId:null,salesOrderId:null,reason:"",returnDate:new Date().toISOString().split("T")[0],description:"",attachment:null,status:"draft",totalReturnAmount:0,salesReturnItems:[]},isEditMode:!1,showModal:!1,validationErrors:[]}),getters:{allAvailableProducts(i){const u=K().products||[],r=i.salesOrders||[],v=new Map;return u.forEach(l=>v.set(l.id,l)),r.forEach(l=>v.set(l.id,l)),Array.from(v.values())}},actions:{async fetchSalesReturns(){var d;this.loading=!0,this.error=null;const{$api:i}=U();try{const v=(await(await fetch(i.csrfToken(),{credentials:"include"})).json()).token,l=localStorage.getItem("token");if(!v)throw new Error("CSRF token not found. Cannot proceed with request.");const c=new URL(i.salesReturn()),h=new URLSearchParams({page:(this.params.first/this.params.rows+1).toString(),rows:this.params.rows.toString(),sortField:this.params.sortField||"",sortOrder:((d=this.params.sortOrder)==null?void 0:d.toString())||"",draw:this.params.draw.toString(),search:this.params.search||""});this.params.customerId&&h.append("customerId",this.params.customerId.toString()),this.params.status&&h.append("status",this.params.status),this.params.perusahaanId&&h.append("perusahaanId",this.params.perusahaanId.toString()),c.search=h.toString();const I=await fetch(c,{method:"GET",headers:{Authorization:`Bearer ${l}`,Accept:"application/json","Content-Type":"application/json"},credentials:"include"});if(!I.ok)throw new Error("Gagal mengambil data salesReturn");const b=await I.json();this.salesReturns=b.data,this.totalRecords=b.meta.total}catch(u){console.error("Gagal mengambil data salesReturn:",u),this.error=u,S.fire("Error",`Tidak dapat memuat data Sales Return: ${u.message}`,"error")}finally{this.loading=!1}},async fetchSalesOrdersByCustomer(i){this.loading=!0,this.error=null;const{$api:d}=U();if(!i){this.salesOrders=[];return}try{const v=(await(await fetch(d.csrfToken(),{credentials:"include"})).json()).token,l=localStorage.getItem("token");if(!v)throw new Error("CSRF token not found. Cannot proceed with request.");const c=await fetch(d.getSalesOrderForSalesReturn(i),{headers:{Authorization:`Bearer ${l}`,Accept:"application/json"},credentials:"include"});if(!c.ok)throw new Error("Gagal mengambil data sales order untuk customer");const h=await c.json();this.salesOrders=h.data||[]}catch(u){console.error("Error fetching sales order for customer:",u),this.salesOrders=[],S.fire("Error","Gagal memuat sales order untuk customer yang dipilih.","error")}finally{this.loading=!1}},populateFormFromSalesOrder(i){var u;const d=this.salesOrders.find(r=>r.id===i);d&&(this.form.salesOrderId=d.id,this.form.noSo=d.noSo,this.form.customerId=d.customerId,this.form.perusahaanId=d.perusahaanId,this.form.cabangId=d.cabangId,this.form.up=d.up,this.form.totalReturnAmount=d.total,this.form.status="draft",this.form.salesReturnItems=((u=d.salesOrderItems)==null?void 0:u.map(r=>({salesOrderItemId:r.id,productId:r.productId,warehouseId:r.warehouseId,quantity:r.quantity,price:r.price,description:r.description,subtotal:r.subtotal,stock:{quantity:0}})))||[])},async saveSalesReturn(){this.loading=!0,this.validationErrors=[];const{$api:i}=U(),d=oe(),u=le(),r=K(),v=this.form.salesReturnItems.filter(l=>l.productId&&l.warehouseId&&l.quantity>0).map(l=>({productId:l.productId,warehouseId:l.warehouseId,quantity:l.quantity}));if(v.length>0)try{const c=(await u.validateStockBatch(v)).find(h=>!h.hasEnoughStock);if(c){const h=r.products||[],I=this.salesOrders||[],g=[...h,...I].find(E=>E&&E.id===c.productId),O=`Stok untuk produk "${g?g.name:`ID ${c.productId}`}" tidak mencukupi. Stok tersedia: ${Math.floor(Number(c.availableStock))}, kuantitas diminta: ${c.requestedQuantity}.`;this.validationErrors=[{message:O,field:"quantity"}],S.fire("Stok Tidak Cukup",O,"error"),this.loading=!1;return}}catch(l){console.error("Gagal memvalidasi stok:",l),S.fire("Error","Tidak dapat memvalidasi stok untuk produk.","error"),this.loading=!1;return}try{const h=(await(await fetch(i.csrfToken(),{credentials:"include"})).json()).token,I=localStorage.getItem("token");if(!h)throw new Error("CSRF token tidak ditemukan. Tidak dapat melanjutkan request.");const b=new FormData,g={...this.form};delete g.salesReturnItems,delete g.attachment,delete g.customer,delete g.perusahaan,delete g.cabang,delete g.createdByUser,delete g.approvedByUser,delete g.deliveredByUser,delete g.rejectedByUser,Object.keys(g).forEach(k=>{const A=g[k];A!=null&&b.append(k,A)}),!this.isEditMode&&d.user&&d.user.id&&(b.append("createdBy",d.user.id.toString()),this.form.status==="approved"&&b.append("approvedBy",d.user.id.toString()),this.form.status==="rejected"&&b.append("rejectedBy",d.user.id.toString()),this.form.status==="delivered"&&b.append("deliveredBy",d.user.id.toString())),this.form.attachment instanceof File&&b.append("attachment",this.form.attachment),this.form.salesReturnItems.forEach((k,A)=>{k.productId&&k.quantity>0&&Object.keys(k).forEach(q=>{const z=k[q];z!=null&&b.append(`salesReturnItems[${A}][${q}]`,z)})});const P=(this.isEditMode,"POST"),O=this.isEditMode?`${i.salesReturn()}/${this.form.id}`:i.salesReturn();this.isEditMode&&b.append("_method","PUT");const E=await fetch(O,{method:P,headers:{"X-CSRF-TOKEN":h,Authorization:`Bearer ${I}`,Accept:"application/json"},body:b,credentials:"include"});if(E.ok)this.closeModal(),await this.fetchSalesReturns(),S.fire("Berhasil!",`Sales Return berhasil ${this.isEditMode?"diperbarui":"dibuat"}.`,"success");else{const k=await E.json();if(E.status===422)this.validationErrors=k.errors,S.fire("Gagal Validasi",k.message||"Terdapat kesalahan validasi data","error");else throw new Error(k.message||"Gagal menyimpan data salesReturn")}}catch(l){this.validationErrors=[],S.fire("Gagal",l.message||"Operasi gagal","error")}finally{this.loading=!1}},async deleteSalesReturn(i){this.loading=!0;const{$api:d}=U();if(!(await S.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed){this.loading=!1;return}try{const l=(await(await fetch(d.csrfToken(),{credentials:"include"})).json()).token,c=localStorage.getItem("token"),h=await fetch(`${d.salesReturn()}/${i}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":l,Authorization:`Bearer ${c}`,Accept:"application/json"},credentials:"include"});if(!h.ok){const I=await h.json();throw new Error(I.message||"Gagal menghapus Sales Return")}await this.fetchSalesReturns(),S.fire("Berhasil!","Sales Return berhasil dihapus.","success")}catch(r){S.fire("Error",r.message||"Gagal menghapus Sales Return","error")}finally{this.loading=!1}},async approveSalesReturn(i){this.loading=!0,this.error=null;const{$api:d}=U();try{const u=localStorage.getItem("token"),r=await fetch(d.csrfToken(),{credentials:"include"});if(!r.ok)throw new Error("Gagal mendapatkan CSRF token.");const l=(await r.json()).token,c=await fetch(d.approveSalesReturn(i),{method:"PATCH",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l},credentials:"include"});if(!c.ok){const h=await c.json().catch(()=>({message:"Gagal mengapprove sales return"}));throw new Error(h.message||"Gagal mengapprove sales return")}return await this.fetchSalesReturns(),await S.fire("Berhasil!","Sales Return berhasil diapprove.","success"),!0}catch(u){return console.error("Error approving sales return:",u),await S.fire("Error",u.message||"Gagal mengapprove sales return.","error"),!1}finally{this.loading=!1}},async rejectSalesReturn(i){this.loading=!0,this.error=null;const{$api:d}=U();try{const u=localStorage.getItem("token"),r=await fetch(d.csrfToken(),{credentials:"include"});if(!r.ok)throw new Error("Gagal mendapatkan CSRF token.");const l=(await r.json()).token,c=await fetch(d.rejectSalesReturn(i),{method:"PATCH",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l},credentials:"include"});if(!c.ok){const h=await c.json().catch(()=>({message:"Gagal mereject sales return"}));throw new Error(h.message||"Gagal mereject sales return")}return await this.fetchSalesReturns(),await S.fire("Berhasil!","Sales Return berhasil direject.","success"),!0}catch(u){return console.error("Error rejecting sales return:",u),await S.fire("Error",u.message||"Gagal mereject sales return.","error"),!1}finally{this.loading=!1}},async openModal(i=null){if(this.isEditMode=!!i,this.validationErrors=[],i){await this.getSalesReturnDetails(i.id);const d=this.salesReturn;if(!d){S.fire("Error","Tidak dapat memuat data Sales Order.","error");return}this.originalSalesReturn=JSON.parse(JSON.stringify(d));const u=l=>l?new Date(l).toISOString().split("T")[0]:null,r={...JSON.parse(JSON.stringify(d)),attachment:null};["date","dueDate","approvedAt","deliveredAt"].forEach(l=>{r[l]&&(r[l]=u(r[l]))}),this.form=r,this.form.customerId&&await this.fetchSalesOrdersByCustomer(this.form.customerId),this.form.salesReturnItems&&this.form.salesReturnItems.length>0?this.form.salesReturnItems.forEach(l=>{l.stock||(l.stock={quantity:0})}):(this.form.salesReturnItems=[],this.addItem())}else this.resetForm(),this.addItem();this.showModal=!0},closeModal(){this.showModal=!1,this.isEditMode=!1,this.originalSalesReturn=null,this.resetForm(),this.validationErrors=[]},resetForm(){this.form={noSr:"",noSo:"",up:"",customerId:null,salesOrderId:null,perusahaanId:null,cabangId:null,reason:"",returnDate:new Date().toISOString().split("T")[0],description:"",attachment:null,status:"draft",totalReturnAmount:0,salesReturnItems:[]}},addItem(){this.form.salesReturnItems||(this.form.salesReturnItems=[]),this.form.salesReturnItems.push({productId:null,warehouseId:null,quantity:1,price:0,description:"",stock:{quantity:0}})},removeItem(i){this.form.salesReturnItems.splice(i,1)},setPagination(i){this.params.first=i.first,this.params.rows=i.rows,this.fetchSalesReturns()},setSort(i){this.params.sortField=i.sortField,this.params.sortOrder=i.sortOrder,this.fetchSalesReturns()},setSearch(i){this.params.search=i,this.params.first=0,this.fetchSalesReturns()},setFilters(i){this.params.customerId=i.customerId,this.params.perusahaanId=i.perusahaanId,this.params.status=i.status,this.params.search=i.search||"",this.params.first=0,this.fetchSalesReturns()},async getSalesReturnDetails(i){this.loading=!0,this.error=null;const{$api:d}=U();try{const v=(await(await fetch(d.csrfToken(),{credentials:"include"})).json()).token,l=localStorage.getItem("token"),c=await je(d.getSalesReturnDetails(i),{headers:{"X-CSRF-TOKEN":v,Authorization:`Bearer ${l}`,Accept:"application/json"},credentials:"include"});if(!v)throw new Error("CSRF token tidak ditemukan. Tidak dapat melanjutkan request.");if(c&&c.data)this.salesReturn=c.data;else throw new Error("Struktur data tidak valid diterima dari API getSalesReturnDetails.")}catch(u){console.error("Gagal mengambil detail sales return:",u),this.error=u}finally{this.loading=!1}}}}),Le={class:"content-wrapper"},ze={class:"container-xxl flex-grow-1 container-p-y"},He={class:"row g-6 mb-6"},Je={class:"col-xl-4 col-lg-6 col-md-6"},Xe={class:"card h-100"},Ke={class:"row h-100"},We={class:"col-sm-7"},Qe={class:"card-body text-sm-end text-center ps-sm-0"},Ye={class:"row g-6"},Ze={class:"col-12"},et={class:"card"},tt={class:"card-body"},at={class:"row"},st={class:"col-md-4"},rt={class:"col-md-4"},ot={class:"col-md-4"},lt={class:"col-12"},nt={class:"card"},it={class:"card-header d-flex justify-content-between align-items-center flex-wrap"},dt={class:"d-flex align-items-center me-3 mb-2 mb-md-0"},ut={class:"d-flex align-items-center"},ct={class:"btn-group me-2"},pt={class:"dropdown-menu"},mt={class:"input-group"},ft={class:"p-input-icon-left"},ht={class:"card-datatable table-responsive py-3 px-3"},vt={key:0},gt=["href"],bt={key:1},St={key:0},kt=["href"],yt={key:1},wt={class:"d-inline-block"},Rt={class:"dropdown-menu"},It={key:0},_t=["onClick"],Et={key:1},Ct=["onClick"],Ot={key:2},Tt=["onClick"],Dt={key:3},xt=["onClick"],jt={class:"tab-content pt-6"},Vt={class:"tab-pane fade active show",id:"form-tabs-info",role:"tabpanel"},$t={class:"row g-4"},Pt={class:"col-md-12"},At={class:"form-floating form-floating-outline"},Ft={class:"col-md-6"},Ut={class:"col-md-6"},Bt={class:"col-md-6"},Mt={class:"form-floating form-floating-outline"},Nt={class:"col-md-6"},qt={class:"form-floating form-floating-outline"},Gt={class:"col-md-6"},Lt={class:"col-md-6"},zt={class:"col-md-6"},Ht={class:"form-floating form-floating-outline"},Jt=["href"],Xt={class:"col-md-6"},Kt={class:"form-floating form-floating-outline"},Wt=["value"],Qt={class:"col-md-12"},Yt={class:"form-floating form-floating-outline"},Zt={class:"tab-pane fade",id:"form-tabs-items",role:"tabpanel"},ea={class:"row g-3"},ta={class:"col-6"},aa={class:"col-md-6"},sa={class:"col-md-3"},ra={class:"form-floating form-floating-outline"},oa=["onUpdate:modelValue","onInput"],la={class:"col-md-3"},na={class:"form-floating form-floating-outline"},ia=["value"],da={class:"col-md-6"},ua={class:"form-floating form-floating-outline"},ca=["onUpdate:modelValue"],pa={class:"col-md-9"},ma={class:"form-floating form-floating-outline"},fa=["onUpdate:modelValue"],ha={class:"col-md-3 d-flex align-items-center"},va=["onClick"],ga={class:"modal-footer mt-6"},ba=["disabled"],Sa={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},ka={__name:"sales-return",setup(i){const d=De();Ie();const u=G(null),r=Ge(),v=Ve(),l=$e(),c=Ae(),h=Pe(),I=K();le();const b=oe(),g=Ne(),{userHasPermission:P,userHasRole:O}=Ue(),E=Fe(),{salesReturns:k,salesOrders:A,loading:q,totalRecords:z,params:T,form:n,isEditMode:H,showModal:ne,validationErrors:ie,allAvailableProducts:W}=j(r),{customers:Q}=j(v),{perusahaans:Y}=j(l),{cabangs:Z}=j(h),{warehouses:de}=j(c),{products:ya}=j(I),{user:wa}=j(b),{permissions:Ra}=j(E),D=G({customerId:null,perusahaanId:null,status:null,search:""}),J=G(""),x=G(null),ue=G([10,25,50,100]),ce=X(()=>H.value?"Edit Sales Return":"Tambah Sales Return"),pe=X(()=>H.value?"Silakan ubah data Sales Return di bawah ini.":"Silakan isi form di bawah ini untuk menambahkan data Sales Return baru."),ee=o=>!o||typeof o!="string"?null:o.startsWith("http")?o:`${(d.public.apiBase||"").replace("/api","")}/${o}`,me=G([{label:"Draft",value:"draft"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}]);let F=null;we(()=>{r.fetchSalesReturns(),v.fetchCustomers(),l.fetchPerusahaans(),h.fetchCabangs(),I.fetchProducts(),c.fetchWarehouses(),E.fetchPermissions(),b.loadUser();const o=document.getElementById("SalesReturnModal");o&&(F=new bootstrap.Modal(o))}),B(ne,o=>{o?(F==null||F.show(),H.value?(n.value.attachment_url?x.value=n.value.attachment_url:n.value.attachment?x.value=ee(n.value.attachment):x.value=null,n.value.salesReturnItems&&n.value.salesReturnItems.length>0&&n.value.salesReturnItems.forEach((t,a)=>{updateStockInfo(a)})):x.value=null):F==null||F.hide()}),B(()=>n.value.perusahaanId,(o,t)=>{t&&o!==t&&!H.value&&(n.value.cabangId=null)}),B(()=>n.value.customerId,(o,t)=>{o&&o!==t?(r.fetchSalesOrdersByCustomer(o),n.value.salesOrderId=null,n.value.salesReturnItems=[],r.addItem()):o||(r.salesOrders=[],n.value.salesOrderId=null,n.value.salesReturnItems=[],r.addItem())}),B(()=>n.value.salesOrderId,o=>{o&&r.populateFormFromSalesOrder(o)}),B(()=>r.allAvailableProducts,o=>{n.value.salesReturnItems&&o&&n.value.salesReturnItems.forEach(t=>{o.some(p=>p.id===t.productId)||(t.productId=null,t.price=0,t.quantity=1,t.subtotal=0)})},{deep:!0});const fe=X(()=>!n.value.perusahaanId||!Z.value?[]:Z.value.filter(o=>o.perusahaanId===n.value.perusahaanId));B(J,qe(o=>{D.value.search=o},500)),B(D,o=>{const{page:t,rows:a,...p}=o;r.setFilters(p)},{deep:!0});const he=o=>{T.value.first=o.first,r.fetchSalesReturns()},ve=()=>{T.value.first=0,r.fetchSalesReturns()},ge=o=>{T.value.sortField=o.sortField,T.value.sortOrder=o.sortOrder,r.fetchSalesReturns()},te=o=>{o==="csv"&&u.value.exportCSV()};function be(o){const t=o.target.files[0];t?(n.value.attachment=t,x.value=URL.createObjectURL(t)):(n.value.attachment=null,x.value=null)}const Se=o=>{const t=n.value.salesReturnItems[o].productId,a=W.value.find(p=>p.id===t);if(a){const p=n.value.salesReturnItems[o];p.price=Number(a.priceSell)||0,calculateSubtotal(o),updateStockInfo(o)}},ae=o=>{switch(o){case"draft":return{text:"Draft",class:"badge rounded-pill bg-label-secondary"};case"approved":return{text:"Approved",class:"badge rounded-pill bg-label-primary"};case"rejected":return{text:"Rejected",class:"badge rounded-pill bg-label-danger"};case"returned":return{text:"Returned",class:"badge rounded-pill bg-label-info"}}};return(o,t)=>(w(),y("div",Le,[e("div",ze,[t[44]||(t[44]=e("h4",{class:"mb-1"},"List Sales Return",-1)),t[45]||(t[45]=e("p",{class:"mb-6"}," List Sales Return yang terdaftar di sistem ",-1)),e("div",He,[t[22]||(t[22]=Re('<div class="col-xl-4 col-lg-6 col-md-6" data-v-eadcd129><div class="card" data-v-eadcd129><div class="card-body" data-v-eadcd129><div class="d-flex justify-content-between align-items-center mb-4" data-v-eadcd129><h5 class="mb-1" data-v-eadcd129>Total Orders</h5><span class="badge bg-label-primary rounded-pill" data-v-eadcd129>Yearly</span></div><div class="d-flex align-items-center" data-v-eadcd129><h1 class="mb-0 display-4" data-v-eadcd129>15</h1><i class="ri-arrow-up-s-line ri-24px text-success" data-v-eadcd129></i><span class="fw-medium text-success" data-v-eadcd129>15.8%</span></div><p class="mb-0 mt-2" data-v-eadcd129>Analytics for last year</p></div></div></div><div class="col-xl-4 col-lg-6 col-md-6" data-v-eadcd129><div class="card" data-v-eadcd129><div class="card-body" data-v-eadcd129><div class="d-flex justify-content-between align-items-center mb-4" data-v-eadcd129><h5 class="mb-1" data-v-eadcd129>Pending Orders</h5><span class="badge bg-label-warning rounded-pill" data-v-eadcd129>Weekly</span></div><div class="d-flex align-items-center" data-v-eadcd129><h1 class="mb-0 display-4" data-v-eadcd129>5</h1><i class="ri-arrow-down-s-line ri-24px text-danger" data-v-eadcd129></i><span class="fw-medium text-danger" data-v-eadcd129>8.2%</span></div><p class="mb-0 mt-2" data-v-eadcd129>Analytics for last week</p></div></div></div>',2)),e("div",Je,[e("div",Xe,[e("div",Ke,[t[21]||(t[21]=e("div",{class:"col-sm-5"},[e("div",{class:"d-flex align-items-end h-100 justify-content-center"},[e("img",{src:xe,class:"img-fluid",alt:"Image",width:"70"})])],-1)),e("div",We,[e("div",Qe,[e("button",{onClick:t[0]||(t[0]=a=>s(r).openModal(null)),class:"btn btn-primary mb-2 text-wrap add-new-role"}," Tambah Sales Return "),t[20]||(t[20]=e("p",{class:"mb-0 mt-1"},"Buat Sales Return baru",-1))])])])])])]),e("div",Ye,[t[31]||(t[31]=e("div",{class:"col-12"},[e("h4",{class:"mt-6 mb-1"},"Total & Filter Sales Return"),e("p",{class:"mb-0"},"Temukan semua akun administrator perusahaan Anda dan Sales Return terkait.")],-1)),e("div",Ze,[e("div",et,[e("div",tt,[e("div",at,[e("div",st,[f(s(C),{modelValue:D.value.customerId,"onUpdate:modelValue":t[1]||(t[1]=a=>D.value.customerId=a),options:s(Q),label:"name",reduce:a=>a.id,placeholder:"Pilih Customer",class:"v-select-style"},null,8,["modelValue","options","reduce"])]),e("div",rt,[f(s(C),{modelValue:D.value.perusahaanId,"onUpdate:modelValue":t[2]||(t[2]=a=>D.value.perusahaanId=a),options:s(Y),label:"nmPerusahaan",reduce:a=>a.id,placeholder:"Pilih Perusahaan",class:"v-select-style"},null,8,["modelValue","options","reduce"])]),e("div",ot,[f(s(C),{modelValue:D.value.status,"onUpdate:modelValue":t[3]||(t[3]=a=>D.value.status=a),options:me.value,label:"label",reduce:a=>a.value,placeholder:"Pilih Status",class:"v-select-style"},null,8,["modelValue","options","reduce"])])])])])]),e("div",lt,[e("div",nt,[e("div",it,[e("div",dt,[t[23]||(t[23]=e("span",{class:"me-2"},"Baris:",-1)),f(s(_e),{modelValue:s(T).rows,"onUpdate:modelValue":t[4]||(t[4]=a=>s(T).rows=a),options:ue.value,onChange:ve,placeholder:"Jumlah",style:{width:"8rem"}},null,8,["modelValue","options"])]),e("div",ut,[e("div",ct,[t[24]||(t[24]=e("button",{class:"btn btn-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"ri-upload-2-line me-1"}),V(" Export ")],-1)),e("ul",pt,[e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:t[5]||(t[5]=a=>te("csv"))},"CSV")]),e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:t[6]||(t[6]=a=>te("pdf"))},"PDF")])])]),e("div",mt,[e("span",ft,[f(s(Ee),{modelValue:J.value,"onUpdate:modelValue":t[7]||(t[7]=a=>J.value=a),placeholder:"Cari Sales Return...",class:"w-full md:w-20rem"},null,8,["modelValue"])])])])]),e("div",ht,[f(Me,{ref_key:"myDataTableRef",ref:u,data:s(k),rows:s(T).rows,loading:s(q),totalRecords:s(z),lazy:!0,onPage:t[8]||(t[8]=a=>he(a)),onSort:t[9]||(t[9]=a=>ge(a)),responsiveLayout:"scroll",paginatorPosition:"bottom",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:"Menampilkan {first} sampai {last} dari {totalRecords} data"},{default:_(()=>[f(s(R),{header:"#",sortable:!1},{body:_(a=>[V($(s(T).first+a.index+1),1)]),_:1}),f(s(R),{field:"noSr",header:"No. SR",sortable:!0,class:"text-nowrap"},{body:_(a=>[e("span",null,$(a.data.noSr||"-"),1)]),_:1}),f(s(R),{field:"salesOrder.noSo",header:"No. SO",sortable:!0,class:"text-nowrap"},{body:_(a=>{var p,m;return[(p=a.data.salesOrder)!=null&&p.noSo&&((m=a.data.salesOrder)!=null&&m.id)?(w(),y("span",vt,[e("a",{href:`/sales/sales-order-detail?id=${a.data.salesOrder.id}`,style:{"text-decoration":"underline",color:"#007bff"}},$(a.data.salesOrder.noSo),9,gt)])):(w(),y("span",bt," - "))]}),_:1}),f(s(R),{field:"customer.name",header:"Nama Customer",sortable:!0}),f(s(R),{field:"status",header:"Status",sortable:!0},{body:_(a=>[e("span",{class:Ce(ae(a.data.status).class)},$(ae(a.data.status).text),3)]),_:1}),f(s(R),{field:"createdByUser.fullName",header:"Dibuat Oleh",sortable:!0},{body:_(a=>{var p;return[e("span",null,$(((p=a.data.createdByUser)==null?void 0:p.fullName)||"-"),1)]}),_:1}),f(s(R),{field:"approvedByUser.fullName",header:"Approved By",sortable:!0},{body:_(a=>{var p;return[e("span",null,$(((p=a.data.approvedByUser)==null?void 0:p.fullName)||"-"),1)]}),_:1}),f(s(R),{field:"salesOrder.up",header:"Untuk Perhatian",sortable:!0}),f(s(R),{field:"returnDate",header:"Tanggal",sortable:!0},{body:_(a=>[V($(a.data.returnDate?new Date(a.data.returnDate).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"),1)]),_:1}),f(s(R),{field:"perusahaan.nmPerusahaan",header:"Perusahaan",sortable:!0}),f(s(R),{field:"cabang.nmCabang",header:"Cabang",sortable:!0}),f(s(R),{field:"attachment",header:"Nama File",sortable:!0},{body:_(a=>[a.data.attachment?(w(),y("div",St,[e("a",{href:ee(a.data.attachment),target:"_blank",rel:"noopener noreferrer",style:{"text-decoration":"underline",color:"#007bff"}},$(a.data.attachment.split("/").pop()),9,kt)])):(w(),y("div",yt,t[25]||(t[25]=[e("span",{class:"text-muted"},"Tidak ada file",-1)])))]),_:1}),f(s(R),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:_(a=>[e("div",wt,[t[30]||(t[30]=e("a",{href:"javascript:;",class:"btn btn-sm btn-text-secondary rounded-pill btn-icon dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[e("i",{class:"ri-more-2-fill"})],-1)),e("ul",Rt,[s(P)("approve_sales_return")&&a.data.status=="draft"?(w(),y("li",It,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:p=>s(r).approveSalesReturn(a.data.id)},t[26]||(t[26]=[e("i",{class:"ri-check-line me-2"},null,-1),V(" Approve ")]),8,_t)])):L("",!0),s(O)("superadmin")||s(P)("reject_sales_return")&&a.data.status=="draft"?(w(),y("li",Et,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:p=>s(r).rejectSalesReturn(a.data.id)},t[27]||(t[27]=[e("i",{class:"ri-close-line me-2"},null,-1),V(" Reject ")]),8,Ct)])):L("",!0),s(O)("superadmin")||s(P)("edit_sales_return")&&a.data.status=="draft"?(w(),y("li",Ot,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:p=>s(r).openModal(a.data)},t[28]||(t[28]=[e("i",{class:"ri-edit-box-line me-2"},null,-1),V(" Edit ")]),8,Tt)])):L("",!0),s(O)("superadmin")||s(P)("delete_sales_return")?(w(),y("li",Dt,[e("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:p=>s(r).deleteSalesReturn(a.data.id)},t[29]||(t[29]=[e("i",{class:"ri-delete-bin-7-line me-2"},null,-1),V(" Hapus ")]),8,xt)])):L("",!0)])])]),_:1})]),_:1},8,["data","rows","loading","totalRecords"])])])])]),f(Be,{id:"SalesReturnModal",title:ce.value,description:pe.value,"validation-errors-from-parent":s(ie)},{default:_(()=>[e("form",{onSubmit:t[19]||(t[19]=re(a=>s(r).saveSalesReturn(),["prevent"]))},[t[43]||(t[43]=e("div",{class:"row"},[e("div",{class:"col"},[e("ul",{class:"nav nav-tabs",role:"tablist"},[e("li",{class:"nav-item"},[e("button",{class:"nav-link active","data-bs-toggle":"tab","data-bs-target":"#form-tabs-info",role:"tab","aria-selected":"true",type:"button"},[e("span",{class:"ri-user-line ri-20px d-sm-none"}),e("span",{class:"d-none d-sm-block"},"Informasi Sales Return")])]),e("li",{class:"nav-item"},[e("button",{class:"nav-link","data-bs-toggle":"tab","data-bs-target":"#form-tabs-items",role:"tab","aria-selected":"false",type:"button"},[e("span",{class:"ri-folder-user-line ri-20px d-sm-none"}),e("span",{class:"d-none d-sm-block"},"List Product")])])])])],-1)),e("div",jt,[e("div",Vt,[e("div",$t,[e("div",Pt,[e("div",At,[M(e("input",{type:"hidden","onUpdate:modelValue":t[10]||(t[10]=a=>s(n).noSr=a),class:"form-control",placeholder:"No SR",required:""},null,512),[[N,s(n).noSr]])])]),e("div",Ft,[f(s(C),{modelValue:s(n).customerId,"onUpdate:modelValue":t[11]||(t[11]=a=>s(n).customerId=a),options:s(Q),label:"name",reduce:a=>a.id,placeholder:"Pilih Customer",class:"v-select-style"},null,8,["modelValue","options","reduce"])]),e("div",Ut,[f(s(C),{modelValue:s(n).salesOrderId,"onUpdate:modelValue":t[12]||(t[12]=a=>s(n).salesOrderId=a),options:s(A),label:"noSo",reduce:a=>a.id,placeholder:"Pilih Sales Order",class:"v-select-style",disabled:!s(n).customerId},null,8,["modelValue","options","reduce","disabled"])]),e("div",Bt,[e("div",Mt,[M(e("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=a=>s(n).up=a),class:"form-control",placeholder:"Untuk Perhatian",readonly:""},null,512),[[N,s(n).up]]),t[32]||(t[32]=e("label",null,"Untuk Perhatian",-1))])]),e("div",Nt,[e("div",qt,[M(e("input",{type:"date","onUpdate:modelValue":t[14]||(t[14]=a=>s(n).returnDate=a),class:"form-control",required:""},null,512),[[N,s(n).returnDate]]),t[33]||(t[33]=e("label",null,"Tanggal Pengembalian",-1))])]),e("div",Gt,[f(s(C),{modelValue:s(n).perusahaanId,"onUpdate:modelValue":t[15]||(t[15]=a=>s(n).perusahaanId=a),options:s(Y),label:"nmPerusahaan",reduce:a=>a.id,placeholder:"Pilih Perusahaan",class:"v-select-style",readonly:""},null,8,["modelValue","options","reduce"])]),e("div",Lt,[f(s(C),{modelValue:s(n).cabangId,"onUpdate:modelValue":t[16]||(t[16]=a=>s(n).cabangId=a),options:fe.value,label:"nmCabang",reduce:a=>a.id,placeholder:"Pilih Cabang",class:"v-select-style",readonly:""},null,8,["modelValue","options","reduce"])]),e("div",zt,[e("div",Ht,[e("input",{type:"file",onChange:be,class:"form-control"},null,32),t[34]||(t[34]=e("label",null,"Attachment",-1)),x.value?(w(),y("a",{key:0,href:x.value,target:"_blank",class:"d-block mt-1"},"Lihat Attachment",8,Jt)):L("",!0)])]),e("div",Xt,[e("div",Kt,[e("input",{type:"text",value:s(g)(s(n).totalReturnAmount),class:"form-control",placeholder:"Total"},null,8,Wt),t[35]||(t[35]=e("label",null,"Total Pengembalian",-1))])]),e("div",Qt,[e("div",Yt,[M(e("textarea",{"onUpdate:modelValue":t[17]||(t[17]=a=>s(n).description=a),class:"form-control",placeholder:"Deskripsi"},null,512),[[N,s(n).description]]),t[36]||(t[36]=e("label",null,"Deskripsi",-1))])])])]),e("div",Zt,[(w(!0),y(Oe,null,Te(s(n).salesReturnItems,(a,p)=>(w(),y("div",{key:p,class:"repeater-item mb-4"},[e("div",ea,[e("div",ta,[f(s(C),{modelValue:a.warehouseId,"onUpdate:modelValue":[m=>a.warehouseId=m,m=>o.updateStockInfo(p)],options:s(de),"get-option-label":m=>`${m.name} (${m.code})`,reduce:m=>m.id,placeholder:"Pilih Gudang",class:"v-select-style",readonly:""},null,8,["modelValue","onUpdate:modelValue","options","get-option-label","reduce"])]),e("div",aa,[f(s(C),{modelValue:a.productId,"onUpdate:modelValue":[m=>a.productId=m,m=>Se(p)],options:s(W),"get-option-label":m=>{var se;return`${m.name} (${(se=m.unit)==null?void 0:se.name})`},reduce:m=>m.id,placeholder:"Pilih Produk",class:"v-select-style",readonly:""},null,8,["modelValue","onUpdate:modelValue","options","get-option-label","reduce"])]),e("div",sa,[e("div",ra,[M(e("input",{type:"number","onUpdate:modelValue":m=>a.quantity=m,onInput:m=>o.onQuantityChange(p),class:"form-control",placeholder:"Qty",readonly:""},null,40,oa),[[N,a.quantity,void 0,{number:!0}]]),t[37]||(t[37]=e("label",null,"Jumlah",-1))])]),e("div",la,[e("div",na,[e("input",{type:"text",value:s(g)(a.price),class:"form-control",placeholder:"Harga",readonly:""},null,8,ia),t[38]||(t[38]=e("label",null,"Harga",-1))])]),e("div",da,[e("div",ua,[M(e("input",{type:"text","onUpdate:modelValue":m=>a.reason=m,class:"form-control",placeholder:"Alasan"},null,8,ca),[[N,a.reason]]),t[39]||(t[39]=e("label",null,"Alasan",-1))])]),e("div",pa,[e("div",ma,[M(e("input",{type:"text","onUpdate:modelValue":m=>a.description=m,class:"form-control",placeholder:"Deskripsi item",readonly:""},null,8,fa),[[N,a.description]]),t[40]||(t[40]=e("label",null,"Deskripsi",-1))])]),e("div",ha,[e("button",{onClick:re(m=>s(r).removeItem(p),["prevent"]),class:"btn btn-outline-danger w-100"},"Hapus",8,va)])]),t[41]||(t[41]=e("hr",{class:"my-4"},null,-1))]))),128))])]),e("div",ga,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[18]||(t[18]=a=>s(r).closeModal())},"Tutup"),e("button",{type:"submit",class:"btn btn-primary",disabled:s(q)},[s(q)?(w(),y("span",Sa)):L("",!0),t[42]||(t[42]=V(" Simpan "))],8,ba)])],32)]),_:1},8,["title","description","validation-errors-from-parent"])]),t[46]||(t[46]=e("div",{class:"content-backdrop fade"},null,-1))]))}},qa=ye(ka,[["__scopeId","data-v-eadcd129"]]);export{qa as default};
